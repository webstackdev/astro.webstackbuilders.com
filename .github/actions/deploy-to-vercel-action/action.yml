name: 'Deploy to Vercel Action'
description: 'Deploy your project to Vercel using GitHub Actions. Supports PR previews and GitHub deployments.'

inputs:
  GITHUB_TOKEN:
    description: |
      GitHub Token which will be used to authenticate with the GitHub API.
    required: true
  VERCEL_TOKEN:
    description: |
      Vercel Token which will be used with the Vercel CLI.
    required: true
  VERCEL_PROJECT_ID:
    description: |
      Id of your Vercel project (can be found in .vercel/project.json).
    required: true
  VERCEL_ORG_ID:
    description: |
      Id of your Vercel organisation (can be found in .vercel/project.json).
    required: true
  PRODUCTION:
    description: |
      Create a production deployment (default: true, false for PR deployments).
    required: false
  PUBLIC_GOOGLE_MAPS_API_KEY:
    description: |
      Public Google Maps API key used at build-time.
    required: true
  PUBLIC_SENTRY_DSN:
    description: |
      Public Sentry DSN used at build-time.
    required: true
  PUBLIC_UPSTASH_SEARCH_REST_URL:
    description: |
      Public Upstash Search REST URL used at build-time.
    required: true
  PUBLIC_UPSTASH_SEARCH_READONLY_TOKEN:
    description: |
      Public Upstash Search read-only token used at build-time.
    required: true
  PR_LABELS:
    description: |
      Labels which will be added to the pull request once deployed. Set it to false to turn off (default: deployed).
    required: false
  ALIAS_DOMAINS:
    description: |
      Assign alias domain(s) to the deployment.
    required: false
  PR_PREVIEW_DOMAIN:
    description: |
      Assign a custom domain to the PR preview deployment.
    required: false
  VERCEL_SCOPE:
    description: |
      Execute commands from a different Vercel team or user.
    required: false
  GITHUB_DEPLOYMENT_ENV:
    description: |
      Custom environment for GitHub deployment.
    required: false
  WORKING_DIRECTORY:
    description: |
      Working directory for the Vercel CLI.
    required: false

outputs:
  PREVIEW_URL:
    description: 'Main deployment preview URL.'
    value: ${{ steps.deploy.outputs.PREVIEW_URL }}
  DEPLOYMENT_URLS:
    description: 'All assigned deployment URLs.'
    value: ${{ steps.deploy.outputs.DEPLOYMENT_URLS }}
  DEPLOYMENT_ID:
    description: 'The Vercel deployment ID.'
    value: ${{ steps.deploy.outputs.DEPLOYMENT_ID }}
  DEPLOYMENT_CREATED:
    description: 'True if a Vercel deployment was created.'
    value: ${{ steps.deploy.outputs.DEPLOYMENT_CREATED }}
  COMMENT_CREATED:
    description: 'True if a comment was created on the PR or commit.'
    value: ${{ steps.deploy.outputs.COMMENT_CREATED }}
  DEPLOYMENT_INSPECTOR_URL:
    description: 'Main deployment inspection url.'
    value: ${{ steps.deploy.outputs.DEPLOYMENT_INSPECTOR_URL }}
  DEPLOYMENT_UNIQUE_URL:
    description: 'The unique deployment url on Vercel'
    value: ${{ steps.deploy.outputs.DEPLOYMENT_UNIQUE_URL }}

runs:
  using: composite
  steps:
    - name: Deploy to Vercel
      id: deploy
      run: python3 ${{ github.action_path }}/src/main.py
      shell: bash
      env:
        INPUT_GITHUB_TOKEN: ${{ inputs.GITHUB_TOKEN }}
        INPUT_VERCEL_TOKEN: ${{ inputs.VERCEL_TOKEN }}
        INPUT_VERCEL_PROJECT_ID: ${{ inputs.VERCEL_PROJECT_ID }}
        INPUT_VERCEL_ORG_ID: ${{ inputs.VERCEL_ORG_ID }}
        INPUT_PRODUCTION: ${{ inputs.PRODUCTION }}
        INPUT_PUBLIC_GOOGLE_MAPS_API_KEY: ${{ inputs.PUBLIC_GOOGLE_MAPS_API_KEY }}
        INPUT_PUBLIC_SENTRY_DSN: ${{ inputs.PUBLIC_SENTRY_DSN }}
        INPUT_PUBLIC_UPSTASH_SEARCH_REST_URL: ${{ inputs.PUBLIC_UPSTASH_SEARCH_REST_URL }}
        INPUT_PUBLIC_UPSTASH_SEARCH_READONLY_TOKEN: ${{ inputs.PUBLIC_UPSTASH_SEARCH_READONLY_TOKEN }}
        INPUT_PR_LABELS: ${{ inputs.PR_LABELS }}
        INPUT_ALIAS_DOMAINS: ${{ inputs.ALIAS_DOMAINS }}
        INPUT_PR_PREVIEW_DOMAIN: ${{ inputs.PR_PREVIEW_DOMAIN }}
        INPUT_VERCEL_SCOPE: ${{ inputs.VERCEL_SCOPE }}
        INPUT_GITHUB_DEPLOYMENT_ENV: ${{ inputs.GITHUB_DEPLOYMENT_ENV }}
        INPUT_WORKING_DIRECTORY: ${{ inputs.WORKING_DIRECTORY }}

branding:
  icon: 'activity'
  color: 'blue'
