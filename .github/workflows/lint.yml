# Runs lint checks and a green build to gate deployments
name: Lint

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

permissions: {}

jobs:
  lint:
    name: Lint
    runs-on: ubuntu-latest
    environment: testing
    if: ${{ !startsWith(github.head_ref || github.ref_name, 'hotfix/') }}

    permissions:
      contents: read

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6.0.1

      - name: Setup Python
        uses: actions/setup-python@v6.1.0
        with:
          python-version: '3.13'
          cache: 'pip'

      - name: Install Python dependencies
        run: python3 -m pip install -r requirements.txt

      - name: Setup Node.js
        uses: actions/setup-node@v6.1.0
        with:
          node-version: '22.x'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci --force

      - name: Run lint
        run: npm run lint

      - name: Run Astro Check
        run: npm run check

  hotfix-bypass:
    name: Lint Hotfix Bypass
    runs-on: ubuntu-latest
    if: ${{ startsWith(github.head_ref || github.ref_name, 'hotfix/') }}

    permissions: {}

    steps:
      - name: Skip lint for hotfix branch
        run: echo "hotfix/* branch detected; skipping lint but allowing deployments."

