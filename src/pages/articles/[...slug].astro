---
import { getCollection } from 'astro:content'
import ArticleLayout from "@layouts/ArticleLayout.astro"
import SuggestedArticles from "@components/SuggestedArticles/SuggestedArticles.astro"

export async function getStaticPaths() {
  const articleEntries = await getCollection('articles', ({ data }) => {
    return import.meta.env.PROD ? data.isDraft !== true : true;
  })
  return articleEntries.map(article => ({
    params: { slug: article.id }, props: { article },
  }))
}

const { article } = Astro.props
// Use the rendered content directly from the article
const renderedContent = article.rendered?.html || article.body || 'Content not available';
const path = `/articles/${article.id}/`
---

<ArticleLayout
  pageTitle={article.data.title}
  path={path}
  cover={article.data.image}
  meta={{
    date: article.data.publishDate,
    author: (article.data.author as any).id || String(article.data.author),
    tags: article.data.tags,
    draft: article.data.isDraft
  }}
>
  <div set:html={renderedContent} />

  <SuggestedArticles currentSlug={article.id} limit={5} slot="suggested-content" />
</ArticleLayout>
