---
import BaseLayout from '@layouts/BaseLayout.astro'
import { getSiteUrl } from '@components/scripts/utils/siteUrlClient'

const pageTitle = 'Site URL Client Diagnostics'
const pageDescription = 'Client-side site URL snapshot for automated testing only.'
const pagePath = '/testing/site-url-client'

const snapshot = {
  siteUrl: getSiteUrl(),
}

const formattedSnapshot = JSON.stringify(snapshot, null, 2)
const scriptContent = `window.siteUrlClientSnapshot = ${JSON.stringify(snapshot).replace(/</g, '\\u003c')}`
---

<BaseLayout pageTitle={pageTitle} path={pagePath} description={pageDescription} noindex>
  <section class="mx-auto mb-6 max-w-3xl space-y-3 text-lg text-offset">
    <p>
      This fixture mirrors the client-side site URL utility so tests can compare server and browser
      results.
    </p>
    <p data-testid="site-url-client-notice">
      The snapshot is also copied to <code>window.siteUrlClientSnapshot</code> for Playwright assertions.
    </p>
  </section>

  <section class="mx-auto max-w-3xl">
    <pre
      id="site-url-client-json"
      class="overflow-auto rounded border border-border bg-content-inverse-offset p-4 font-mono text-sm text-text">{formattedSnapshot}</pre>
  </section>

  <script type="module" is:inline set:html={scriptContent} />
</BaseLayout>
