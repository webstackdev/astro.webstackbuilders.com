---
import { getCollection } from 'astro:content'
import { Picture } from 'astro:assets'
import MarkdownLayout from '@layouts/MarkdownLayout.astro'
import Carousel from '@components/Carousel/index.astro'
import WebMentions from '@components/WebMentions/index.astro'

/** Generate static paths for all case studies */
export async function getStaticPaths() {
  const caseStudyEntries = await getCollection('caseStudies')
  return caseStudyEntries.map(caseStudy => ({
    params: { slug: caseStudy.id },
    props: { caseStudy },
  }))
}

const { caseStudy } = Astro.props

const path = `/case-studies/${caseStudy.id}`
const section = 'Case Studies'
---

<MarkdownLayout
  collectionItem={caseStudy}
  contentType="article"
  description={caseStudy.data.description}
  pageTitle={caseStudy.data.title}
  path={path}
  publishDate={caseStudy.data.publishDate}
  section={section}
  showToc={false}
  tags={caseStudy.data.tags}
>
  {/** SLOT: hero-image */}
  {
    caseStudy.data.cover && (
      <div
        class="relative aspect-video max-w-3xl mx-auto rounded-2xl overflow-hidden shadow-lg mb-8"
        slot="hero-image"
      >
        <Picture
          src={caseStudy.data.cover}
          alt={caseStudy.data.coverAlt}
          widths={[640, 960, 1280, 1920]}
          sizes="(min-width: 1280px) 80vw, 100vw"
          formats={['avif', 'webp', 'jpeg']}
          layout="constrained"
          fit="cover"
          position="center"
          class="absolute inset-0 h-full w-full object-cover"
          loading="eager"
        />
      </div>
    )
  }

  <div class="space-y-4 max-w-2xl mx-auto mb-8">
    <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
      {
        caseStudy.data.client && (
          <div class="bg-bg-offset p-4 rounded-xl flex flex-wrap items-baseline gap-x-2">
            <dt class="font-semibold text-text">Client:</dt>
            <dd class="text-text-offset">{caseStudy.data.client}</dd>
          </div>
        )
      }
      {
        caseStudy.data.industry && (
          <div class="bg-bg-offset p-4 rounded-xl flex flex-wrap items-baseline gap-x-2">
            <dt class="font-semibold text-text">Industry:</dt>
            <dd class="text-text-offset">{caseStudy.data.industry}</dd>
          </div>
        )
      }
      {
        caseStudy.data.projectType && (
          <div class="bg-bg-offset p-4 rounded-xl flex flex-wrap items-baseline gap-x-2">
            <dt class="font-semibold text-text">Project Type:</dt>
            <dd class="text-text-offset">{caseStudy.data.projectType}</dd>
          </div>
        )
      }
      {
        caseStudy.data.duration && (
          <div class="bg-bg-offset p-4 rounded-xl flex flex-wrap items-baseline gap-x-2">
            <dt class="font-semibold text-text">Duration:</dt>
            <dd class="text-text-offset">{caseStudy.data.duration}</dd>
          </div>
        )
      }
    </dl>
  </div>

  {/** SLOT: after-content */}
  <div slot="after-content">
    {/* WebMentions - shows mentions, likes, and reposts from across the web */}
    <WebMentions url={`https://webstackbuilders.com${path}`} />
  </div>

  {/** SLOT: related-content */}
  <section
    class="border-t border-border pt-8 mt-12"
    slot="related-content"
    aria-labelledby="case-study-related-title"
  >
    <header class="mb-8">
      <h2 id="case-study-related-title" class="text-2xl font-bold text-text">Other projects I've worked on</h2>
    </header>
    <Carousel title="" variant="suggested" currentSlug={caseStudy.id} limit={4} type="case-studies" />
  </section>
</MarkdownLayout>

