---
import { getCollection } from 'astro:content'
import { Picture } from 'astro:assets'
import MarkdownLayout from '@layouts/MarkdownLayout.astro'
import Carousel from '@components/Carousel/index.astro'
import WebMentions from '@components/WebMentions/index.astro'

/** Generate static paths for all case studies */
export async function getStaticPaths() {
  const caseStudyEntries = await getCollection('caseStudies')
  return caseStudyEntries.map(caseStudy => ({
    params: { slug: caseStudy.id },
    props: { caseStudy },
  }))
}

const { caseStudy } = Astro.props
const path = `/case-studies/${caseStudy.id}`
const pageTitle = caseStudy.data.title
const cover = caseStudy.data.cover
---

<MarkdownLayout
  pageTitle={pageTitle}
  path={path}
  contentType="article"
  collectionItem={caseStudy}
  publishDate={caseStudy.data.publishDate}
  tags={caseStudy.data.tags}
  {...(caseStudy.data.description && { description: caseStudy.data.description })}
  {...(cover?.src && { image: cover.src })}
  showToc={false}
>
  {/** SLOT: hero-image */}
  {
    cover?.src && (
      <div
        class="relative aspect-video max-w-3xl mx-auto rounded-2xl overflow-hidden shadow-lg mb-8"
        slot="hero-image"
      >
        <Picture
          src={cover.src}
          alt={cover.alt}
          widths={[640, 960, 1280, 1920]}
          sizes="(min-width: 1280px) 80vw, 100vw"
          formats={['avif', 'webp', 'jpeg']}
          layout="constrained"
          fit="cover"
          position="center"
          class="absolute inset-0 h-full w-full object-cover"
          loading="eager"
        />
      </div>
    )
  }

  <div class="space-y-4 max-w-2xl mx-auto mb-8">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
      {
        caseStudy.data.client && (
          <div class="bg-bg-offset p-4 rounded-xl">
            <span class="font-semibold text-text">Client:</span>
            <span class="ml-2 text-text-offset">
              {caseStudy.data.client}
            </span>
          </div>
        )
      }
      {
        caseStudy.data.industry && (
          <div class="bg-bg-offset p-4 rounded-xl">
            <span class="font-semibold text-text">Industry:</span>
            <span class="ml-2 text-text-offset">
              {caseStudy.data.industry}
            </span>
          </div>
        )
      }
      {
        caseStudy.data.projectType && (
          <div class="bg-bg-offset p-4 rounded-xl">
            <span class="font-semibold text-text">Project Type:</span>
            <span class="ml-2 text-text-offset">
              {caseStudy.data.projectType}
            </span>
          </div>
        )
      }
      {
        caseStudy.data.duration && (
          <div class="bg-bg-offset p-4 rounded-xl">
            <span class="font-semibold text-text">Duration:</span>
            <span class="ml-2 text-text-offset">
              {caseStudy.data.duration}
            </span>
          </div>
        )
      }
    </div>
  </div>

  {/** SLOT: after-content */}
  <div slot="after-content">
    {/* WebMentions - shows mentions, likes, and reposts from across the web */}
    <WebMentions url={`https://webstackbuilders.com${path}`} />
  </div>

  {/** SLOT: related-content */}
  <div class="border-t border-border pt-8 mt-12" slot="related-content">
    <header class="mb-8">
      <h3 class="text-2xl font-bold text-text">Other projects I've worked on</h3>
    </header>
    <Carousel title="" variant="suggested" currentSlug={caseStudy.id} limit={4} type="case-studies" />
  </div>
</MarkdownLayout>

