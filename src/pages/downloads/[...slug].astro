---
import { type CollectionEntry, getCollection } from 'astro:content'
import { isDev } from '@lib/config/environmentServer'
import BaseLayout from '@layouts/BaseLayout.astro'
import DownloadPage from '@components/Pages/Download/index.astro'

export interface Props {
  download: CollectionEntry<'downloads'>
}

/** Generate static paths for all downloads */
export async function getStaticPaths() {
  const downloadEntries = await getCollection('downloads', ({ data }) => {
    return isDev() || data.isDraft !== true
  })
  return downloadEntries.map(download => ({
    params: { slug: download.id.replace(/\/download$/, '') },
    props: { download },
  }))
}

const { download } = Astro.props

const path = `/downloads/${download.id.replace(/\/download$/, '')}`
---

<BaseLayout
  description={download.data.description}
  pageTitle={download.data.title}
  path={path}
  breadcrumbTitle={download.data.title}
  section="Tags"
>
  <DownloadPage
    download={download}
    content={{
      header: {
        title: "Download",
        description: "Download a great PDF file",
      },
    }}
  />
</BaseLayout>
