---
import { type CollectionEntry, getCollection } from 'astro:content'
import { isDev } from '@lib/config/environmentServer'
import PageLayout from '@layouts/PageLayout.astro'
import DownloadPage from '@components/Pages/Downloads/index.astro'

export interface Props {
  download: CollectionEntry<'downloads'>
}

/** Generate static paths for all downloads */
export async function getStaticPaths() {
  const downloadEntries = await getCollection('downloads', ({ data }) => {
    return isDev() || data.isDraft !== true
  })
  return downloadEntries.map(download => ({
    params: { slug: download.id.replace(/\/download$/, '') },
    props: { download },
  }))
}

const { download } = Astro.props

const path = `/downloads/${download.id.replace(/\/download$/, '')}`
---

<PageLayout
  pageTitle={download.data.title}
  pageDescription={download.data.description}
  icon="download-document"
  path={path}
  breadcrumbTitle={download.data.title}
  section="Downloads"
>
  <DownloadPage download={download} />
</PageLayout>
