---
import type { ButtonLabelOptions, ButtonProps } from '@components/Button/server'
import { buildButtonClassList, resolveAriaLabel } from '@components/Button/server'
import Icon from '@components/Icon/index.astro'
import styles from './button.module.css'

type Props = ButtonProps

const {
  text,
  variant = 'primary',
  size = 'medium',
  type = 'button',
  disabled = false,
  class: additionalClasses = '',
  id,
  ariaLabel,
  onClick,
  href,
  icon,
  iconPosition = 'left',
  iconSize,
  ...rest
} = Astro.props

// Combine all classes
const buttonClassList = buildButtonClassList({
  styles,
  variant,
  size,
  additionalClasses,
})

// Determine icon size based on button size if not specified
const defaultIconSize = iconSize || (size === 'small' ? 16 : size === 'large' ? 24 : 20)

const labelOptions: ButtonLabelOptions = { iconPosition }

if (typeof text !== 'undefined') {
  labelOptions.text = text
}

if (typeof ariaLabel !== 'undefined') {
  labelOptions.ariaLabel = ariaLabel
}

if (typeof icon !== 'undefined') {
  labelOptions.icon = icon
}

const computedAriaLabel = resolveAriaLabel(labelOptions)
const ariaAttributes = computedAriaLabel ? { 'aria-label': computedAriaLabel } : {}

const linkHref = disabled ? undefined : href
const linkOnClick = disabled ? undefined : onClick
---

<div style="display: contents">
  {
    href ? (
      <a
        href={linkHref}
        class:list={buttonClassList}
        id={id}
        onclick={linkOnClick}
        aria-disabled={disabled ? 'true' : undefined}
        tabindex={disabled ? -1 : undefined}
        {...ariaAttributes}
        {...rest}
      >
        {icon && (iconPosition === 'left' || iconPosition === 'only') && (
          <Icon name={icon} size={defaultIconSize} class={text ? 'mr-2' : ''} />
        )}
        {text && <span>{text}</span>}
        {icon && iconPosition === 'right' && (
          <Icon name={icon} size={defaultIconSize} class="ml-2" />
        )}
        <slot />
      </a>
    ) : (
      <button
        type={type}
        class:list={buttonClassList}
        disabled={disabled}
        id={id}
        onclick={onClick}
        {...ariaAttributes}
        {...rest}
      >
        {icon && (iconPosition === 'left' || iconPosition === 'only') && (
          <Icon name={icon} size={defaultIconSize} class={text ? 'mr-2' : ''} />
        )}
        {text && <span>{text}</span>}
        {icon && iconPosition === 'right' && (
          <Icon name={icon} size={defaultIconSize} class="ml-2" />
        )}
        <slot />
      </button>
    )
  }
</div>
