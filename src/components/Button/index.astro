---
import type { ButtonLabelOptions, ButtonProps } from '@components/Button/server'
import { buildButtonClassList, resolveAriaLabel } from '@components/Button/server'
import AnchorLayout from '@components/Button/layouts/anchor.astro'
import DefaultLayout from '@components/Button/layouts/default.astro'

type Props = ButtonProps

const {
  text,
  variant = 'primary',
  size = 'medium',
  type = 'button',
  disabled = false,
  class: additionalClasses = '',
  id,
  ariaLabel,
  onClick,
  href,
  icon,
  iconPosition = 'left',
  iconSize,
  ...rest
} = Astro.props

// Combine all classes
const buttonClassList = buildButtonClassList({
  variant,
  size,
  additionalClasses,
  icon,
  iconPosition,
  text,
})

// Determine icon size based on button size if not specified
const defaultIconSize = iconSize || (size === 'small' ? 16 : size === 'large' ? 24 : 20)

const labelOptions: ButtonLabelOptions = { iconPosition }

if (typeof text !== 'undefined') {
  labelOptions.text = text
}

if (typeof ariaLabel !== 'undefined') {
  labelOptions.ariaLabel = ariaLabel
}

if (typeof icon !== 'undefined') {
  labelOptions.icon = icon
}

const computedAriaLabel = resolveAriaLabel(labelOptions)
const ariaAttributes = computedAriaLabel ? { 'aria-label': computedAriaLabel } : {}

const hasAriaAttributes = Object.keys(ariaAttributes).length > 0
const anchorOptionalProps = {
  ...(id !== undefined ? { id } : {}),
  ...(onClick !== undefined ? { onClick } : {}),
  ...(icon !== undefined ? { icon } : {}),
  ...(text !== undefined ? { text } : {}),
  ...(hasAriaAttributes ? { ariaAttributes } : {}),
}

const defaultOptionalProps = {
  ...(id !== undefined ? { id } : {}),
  ...(onClick !== undefined ? { onClick } : {}),
  ...(icon !== undefined ? { icon } : {}),
  ...(text !== undefined ? { text } : {}),
  ...(hasAriaAttributes ? { ariaAttributes } : {}),
}
---

<div style="display: contents">
  {
    href ? (
      <AnchorLayout
        href={href}
        disabled={disabled}
        classList={buttonClassList}
        iconPosition={iconPosition}
        iconSize={defaultIconSize}
        attributes={rest}
        {...anchorOptionalProps}
      >
        <slot />
      </AnchorLayout>
    ) : (
      <DefaultLayout
        type={type}
        disabled={disabled}
        classList={buttonClassList}
        iconPosition={iconPosition}
        iconSize={defaultIconSize}
        attributes={rest}
        {...defaultOptionalProps}
      >
        <slot />
      </DefaultLayout>
    )
  }
</div>
