---
/**
 * GDPR Consent Component
 *
 * Reusable checkbox component for GDPR-compliant data collection consent.
 * Use in forms that collect personal data (contact forms, newsletter, etc.)
 *
 * @example
 * ```astro
 * <GDPRConsent
 *   purpose="responding to your inquiry"
 * />
 * ```
 */

import type { ConsentCheckboxProps } from './props'
export type { ConsentCheckboxProps as Props } from './props'

const {
  purpose,
  customText,
  privacyPolicyUrl = '/privacy',
  cookiePolicyUrl = '/consent',
  name = 'consent',
  id = 'gdpr-consent',
  formId,
} = Astro.props as ConsentCheckboxProps
---

<consent-checkbox
  data-purpose={purpose}
  data-form-id={formId ?? undefined}
>
  <div
    class="bg-bg-offset border border-border rounded-lg my-6 p-4"
    id={`${id}-container`}
    data-component="gdpr-consent"
    data-purpose={purpose}
    data-form-id={formId}
  >
    <label class="flex items-start gap-3 cursor-pointer">
      <input
        type="checkbox"
        name={name}
        id={id}
        value="true"
        aria-labelledby={`${id}-label`}
        aria-describedby={`${id}-description`}
        aria-invalid="false"
        class="border-2 border-border rounded mt-0.5 h-5 w-5 shrink-0 cursor-pointer focus:outline-2 focus:outline-offset-2 focus:outline-primary checked:bg-primary checked:border-primary"
      />
      <span id={`${id}-label`} class="sr-only">Consent to data processing</span>
      <span id={`${id}-description`} class="flex-1 text-sm leading-relaxed text-text">
        {customText ? (
          <Fragment set:html={customText} />
        ) : (
          <>
            I consent to Webstack Builders processing my personal data for {purpose}. See our{' '}
            <a
              href={privacyPolicyUrl}
              class="text-primary underline hover:text-primary-hover"
              target="_blank"
              rel="noopener noreferrer"
            >
              Privacy Policy
            </a>{' '}and{' '}
            <a
              href={cookiePolicyUrl}
              class="text-primary underline hover:text-primary-hover"
              target="_blank"
              rel="noopener noreferrer"
            >
              Cookie Policy
            </a>.
          </>
        )}
      </span>
    </label>
    <div
      class="bg-danger-bg text-danger text-sm rounded mt-2 p-2 hidden"
      id={`${id}-error`}
      role="alert"
      aria-live="assertive"
    ></div>
  </div>
</consent-checkbox>

<script>
  import { registerConsentCheckboxWebComponent } from '@components/Consent/Checkbox/client'
  registerConsentCheckboxWebComponent()
</script>
