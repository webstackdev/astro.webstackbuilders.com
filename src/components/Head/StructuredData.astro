---
import contactData from '@content/contact.json'
import { absoluteUrl } from '@components/scripts/utils/absoluteUrl'

export interface Props {
  path: string
  pageTitle: string
  description?: string
  contentType?: 'article' | 'website'
  publishDate?: Date
  modifiedDate?: Date
  author?: string
  image?: string
}

const {
  path,
  pageTitle,
  description,
  contentType = 'website',
  publishDate,
  modifiedDate,
  author,
  image,
} = Astro.props

const baseUrl = Astro.site?.href ?? 'https://webstackbuilders.com'
const currentUrl = absoluteUrl(path, Astro.site)

// Organization schema - always included
const organizationSchema = {
  '@context': 'https://schema.org',
  '@type': 'Organization',
  'name': contactData.company.name,
  'url': contactData.company.url,
  'logo': absoluteUrl('/public/images/logos/company-card.png', Astro.site),
  'description': contactData.company.description,
  'email': contactData.company.email,
  'address': {
    '@type': 'PostalAddress',
    'addressLocality': contactData.company.city,
    'addressRegion': contactData.company.state,
    'addressCountry': contactData.company.country,
  },
  'sameAs': contactData.company.social.map(social => social.url),
}

// WebSite schema - include on homepage
const webSiteSchema = path === '/' || path === '' ? {
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  'name': contactData.company.name,
  'url': contactData.company.url,
  'description': contactData.company.description,
  'publisher': {
    '@type': 'Organization',
    'name': contactData.company.name,
    'logo': {
      '@type': 'ImageObject',
      'url': absoluteUrl('icon-512.png', Astro.site),
    },
  },
} : null

// Article schema - for blog posts
const articleSchema = contentType === 'article' && publishDate ? {
  '@context': 'https://schema.org',
  '@type': 'Article',
  'headline': pageTitle,
  'description': description || contactData.company.description,
  'datePublished': publishDate.toISOString(),
  'dateModified': modifiedDate?.toISOString() || publishDate.toISOString(),
  'author': {
    '@type': 'Person',
    'name': author || contactData.company.author.name,
  },
  'publisher': {
    '@type': 'Organization',
    'name': contactData.company.name,
    'logo': {
      '@type': 'ImageObject',
      'url': absoluteUrl('icon-512.png', Astro.site),
    },
  },
  'url': currentUrl,
  ...(image && { 'image': absoluteUrl(image, Astro.site) }),
} : null

// BreadcrumbList schema - for deep pages (2+ levels)
const pathSegments = path.split('/').filter(Boolean)
const breadcrumbSchema = pathSegments.length >= 2 ? {
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  'itemListElement': [
    {
      '@type': 'ListItem',
      'position': 1,
      'name': 'Home',
      'item': baseUrl,
    },
    ...pathSegments.slice(0, -1).map((segment, index) => ({
      '@type': 'ListItem',
      'position': index + 2,
      'name': segment.charAt(0).toUpperCase() + segment.slice(1).replace(/-/g, ' '),
      'item': absoluteUrl(pathSegments.slice(0, index + 1).join('/'), Astro.site),
    })),
  ],
} : null

// Service schema - for service pages
const serviceSchema = path.startsWith('/services/') && path !== '/services' && path !== '/services/' ? {
  '@context': 'https://schema.org',
  '@type': 'Service',
  'name': pageTitle,
  'description': description || contactData.company.description,
  'provider': {
    '@type': 'Organization',
    'name': contactData.company.name,
    'url': contactData.company.url,
  },
  'url': currentUrl,
} : null

// ContactPage schema - for contact page
const contactPageSchema = path === '/contact' || path === '/contact/' ? {
  '@context': 'https://schema.org',
  '@type': 'ContactPage',
  'name': pageTitle,
  'description': description || contactData.company.description,
  'url': currentUrl,
  'mainEntity': {
    '@type': 'Organization',
    'name': contactData.company.name,
    'email': contactData.company.email,
    'url': contactData.company.url,
  },
} : null

// Collect all schemas
const schemas = [
  organizationSchema,
  webSiteSchema,
  articleSchema,
  breadcrumbSchema,
  serviceSchema,
  contactPageSchema,
].filter(Boolean)
---

{schemas.map((schema) => (
  <script is:inline type="application/ld+json" set:html={JSON.stringify(schema)} />
))}
