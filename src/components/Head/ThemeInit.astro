---
/**
 * Theme Initialization - Inline Script
 *
 * CRITICAL: This script MUST be inlined (is:inline) and run as early as possible
 * to prevent Flash of Unstyled Content (FOUC).
 *
 * Purpose: Set data-theme attribute on <html> from localStorage before page renders
 *
 * Keep this script minimal - it runs synchronously and blocks rendering.
 * Full theme system initialization happens later in AppBootstrap.
 */
---

<script is:inline>
  // IIFE to avoid polluting global scope
  (function() {
    try {
      // Read theme preference from localStorage (set by user's previous selection)
      const stored = localStorage.getItem('theme')

      if (stored && stored !== 'light') {
        // User explicitly chose a theme - apply it immediately
        document.documentElement.setAttribute('data-theme', stored)
      } else if (!stored) {
        // No stored preference - use system preference
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches
        document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light')
      }
      // If stored === 'light', BaseLayout.astro already set it, nothing to do

    } catch {
      // localStorage access can fail (privacy mode, etc.)
      // Fall back to BaseLayout's data-theme="light"
    }
  })()
</script>
