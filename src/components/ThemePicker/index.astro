---
/**
 * Theme Picker Component
 * Uses Web Components for clean, self-contained functionality
 * Works seamlessly with Astro View Transitions
 */
import { themes } from '@components/ThemePicker/server'
import Icon from '@components/Icon/index.astro'
import styles from './themePicker.module.css'

export interface Props {
  closeComponent?: string
  label?: string
}

const { closeComponent = 'close', label = 'Select theme' } = Astro.props
---

<theme-picker transition:name="theme-picker-island" transition:persist>
  <div
    class:list={[styles.themePicker, 'themepicker', 'bg-bg-offset block overflow-hidden relative w-full']}
    data-theme-modal
    data-nosnippet
    id="theme-picker-panel"
    role="region"
    aria-labelledby="theme-picker-label"
    hidden
  >
    <h3
      id="theme-picker-label"
      class="font-sans text-base font-bold tracking-tight leading-[calc(2+0.6)] text-center uppercase"
    >
      {label}
    </h3>
    <ul
      id="theme-menu"
      class:list={[
        styles.list,
        'themepicker__list',
        'block mb-[0.25em] overflow-x-auto overflow-y-hidden py-4 px-6 pb-8 text-center whitespace-nowrap w-full',
      ]}
    >
      {
        themes.map(theme => (
          <li
            class:list={[
              styles.item,
              'themepicker__item',
              'inline-block relative rounded-lg scale-100 ml-4 first:ml-0 hover:shadow-md hover:scale-105 hover:z-1',
            ]}
          >
            <button
              class="themepicker__selectBtn block p-4 rounded-lg border border-bg-offset w-full text-center bg-bg-offset"
              aria-label={`select color theme ${theme.name}`}
              data-theme={theme.id}
            >
              <span class="block text-text">{theme.name}</span>
              <span class="block py-0.5">
                <span
                  class:list={[
                    styles.hue,
                    'themepicker__hue',
                    'rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-primary',
                  ]}
                />
                <span
                  class:list={[
                    styles.hue,
                    'themepicker__hue',
                    'rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-secondary',
                  ]}
                />
                <span
                  class:list={[
                    styles.hue,
                    'themepicker__hue',
                    'rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-border',
                  ]}
                />
                <span
                  class:list={[
                    styles.hue,
                    'themepicker__hue',
                    'rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-text-offset',
                  ]}
                />
                <span
                  class:list={[
                    styles.hue,
                    'themepicker__hue',
                    'rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-text',
                  ]}
                />
              </span>
            </button>
          </li>
        ))
      }
    </ul>
    <button
      class="themepicker__closeBtn bg-secondary border-none text-text flex p-1.5 absolute top-0 right-0 transition-all duration-150 ease-in-out hover:bg-secondary-offset hover:text-text focus:bg-secondary-offset focus:text-text"
      type="button"
      aria-label="Close theme picker dialog"
      data-theme-close
    >
      <Icon name={closeComponent} class="h-8 w-8" />
    </button>
  </div>
</theme-picker>

<script>
  import { registerThemePickerWebComponent } from './client'
  import { themeKeyChangeSideEffectsListener } from '@components/scripts/store'
  registerThemePickerWebComponent()
  themeKeyChangeSideEffectsListener()
</script>