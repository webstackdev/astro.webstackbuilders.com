---
/**
 * Theme Picker Component
 * Uses Web Components for clean, self-contained functionality
 * Works seamlessly with Astro View Transitions
 */
import { themes } from '@components/ThemePicker/server'
import Sprite from '@components/Sprite/index.astro'
import type { SpriteName } from '@components/Sprite/sprites'

export interface Props {
  closeComponent?: string
  label?: string
}

const { closeComponent = 'close', label = 'Select theme' } = Astro.props
---

<style>
  /* Modal max-height animation */
  .themepicker {
    max-height: 0; /** Stays here as it's part of the animation */
    overflow: hidden;
    transition: max-height 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .themepicker[hidden] {
    display: block !important;
  }

  .themepicker.is-open {
    max-height: 14em;
  }

  /* Theme item animations and effects */
  .themepicker__item {
    transition: transform 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .themepicker__item.is-active {
    box-shadow: 0 0 0 2px var(--color-primary) !important;
    transform: scale(1);
    z-index: 1;
  }

  .themepicker__item.is-active::after {
    border-color: transparent transparent var(--color-primary) transparent;
    border-style: solid;
    border-width: 0 10px 12px;
    content: '';
    display: block;
    height: 0;
    left: 50%;
    position: absolute;
    top: 100%;
    transform: translate(-50%, 0.25em);
    width: 0;
  }

  /* Custom scrollbar */
  .themepicker__list::-webkit-scrollbar {
    height: 8px;
  }

  .themepicker__list::-webkit-scrollbar-thumb {
    background: var(--color-border);
  }

  .themepicker__list::-webkit-scrollbar-track {
    background: var(--color-bg-offset);
  }

  /* Overlapping color circles */
  .themepicker__hue + .themepicker__hue {
    margin-left: -0.3125em;
  }
</style>

<theme-picker transition:name="theme-picker-island" transition:persist>
  <div
    class="themepicker bg-bg-offset block overflow-hidden relative w-full"
    data-theme-modal
    data-nosnippet
    hidden
  >
    <h3
      class="font-sans text-base font-bold tracking-tight leading-[calc(2+0.6)] text-center uppercase"
    >
      {label}
    </h3>
    <ul
      id="theme-menu"
      class="themepicker__list block mb-[0.25em] overflow-x-auto overflow-y-hidden py-4 px-6 pb-8 text-center whitespace-nowrap w-full"
      style="-webkit-overflow-scrolling: touch;"
    >
      {
        themes.map(theme => (
          <li class="themepicker__item inline-block relative rounded-lg scale-100 ml-4 first:ml-0 hover:shadow-md hover:scale-105 hover:z-1">
            <button
              class="themepicker__selectBtn block p-4 rounded-lg border border-bg-offset w-full text-center bg-bg-offset"
              aria-label={`select color theme ${theme.name}`}
              data-theme={theme.id}
            >
              <span class="block text-text">{theme.name}</span>
              <span class="block py-0.5">
                <span class="themepicker__hue rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-primary" />
                <span class="themepicker__hue rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-secondary" />
                <span class="themepicker__hue rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-border" />
                <span class="themepicker__hue rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-text-offset" />
                <span class="themepicker__hue rounded-full shadow-[0_0_0_2px_var(--color-text)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-text" />
              </span>
            </button>
          </li>
        ))
      }
    </ul>
    <button
      class="themepicker__closeBtn bg-secondary border-none text-text flex p-1.5 absolute top-0 right-0 transition-all duration-150 ease-in-out hover:bg-secondary-offset hover:text-text focus:bg-secondary-offset focus:text-text"
      type="button"
      aria-label="Close theme picker dialog"
      data-theme-close
    >
      <Sprite name={closeComponent as SpriteName} class="h-8 w-8" />
    </button>
  </div>
</theme-picker>

<script>
  // Import the Web Component - it will auto-register
  import './client'
</script>