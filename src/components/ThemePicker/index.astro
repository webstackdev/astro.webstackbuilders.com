---
/**
 * Theme Picker Component
 * Uses Web Components for clean, self-contained functionality
 * Works seamlessly with Astro View Transitions
 */
import { themes } from '@components/ThemePicker/server'
import Icon from '@components/Icon/index.astro'
import styles from './themePicker.module.css'

export interface Props {
  closeComponent?: string
}

const { closeComponent = 'close' } = Astro.props
---

<theme-picker transition:name="theme-picker-island" transition:persist>
  <div
    class:list={[
      styles.themePicker,
      'themepicker',
      'bg-page-offset block overflow-hidden relative w-full',
    ]}
    data-theme-modal
    data-nosnippet
    id="theme-picker-panel"
    role="region"
    aria-labelledby="theme-picker-label"
    hidden
  >
    <div class="embla relative" role="region" aria-labelledby="theme-picker-label" data-theme-embla>
      <div class="embla__viewport overflow-hidden" data-theme-embla-viewport>
        <ul
          id="theme-menu"
          class:list={[
            styles.ul,
            'themepicker__list',
            'embla__container',
            'w-full flex gap-4 justify-center py-4 px-6 pb-8',
          ]}
        >
          {
            themes.map(theme => (
              <li
                class:list={[
                  styles.li,
                  'themepicker__item',
                  'embla__slide',
                  'relative scale-100 flex-[0_0_auto] min-w-0 rounded-lg',
                  'hover:shadow-md hover:scale-105 hover:z-(--z-raised)',
                ]}
              >
                <button
                  class:list={[
                    'themepicker__selectBtn',
                    [
                      'group', 'block', 'relative', 'w-full', 'bg-page-offset', 'text-center', 'p-4'
                    ],
                    [
                      'border-3', 'border-page-inverse', 'rounded-lg'
                    ],
                    [
                      'after:pointer-events-none', 'after:absolute', 'after:content-[""]', 'after:inset-0', 'after:rounded-none', 'after:border-2', 'after:border-transparent', 'after:opacity-0',   'after:transition-opacity', 'after:duration-150', 'after:ease-out'
                    ],
                    [
                      'focus-visible:outline-none', 'focus-visible:after:opacity-100', 'focus-visible:after:-inset-1.5', 'focus-visible:after:border-spotlight'
                    ],
                  ]}
                  aria-label={`select color theme ${theme.name}`}
                  data-theme={theme.id}
                >
                  <span class="block">
                    <span class="inline-block relative">
                      <span class="themepicker__themeName text-content">{theme.name}</span>
                      {theme.description && (
                        <span
                          class="themepicker__tooltip sr-only"
                          data-theme-tooltip
                        >
                          {theme.description}
                        </span>
                      )}
                    </span>
                  </span>

                  <span class="block py-0.5">
                    <span
                      class:list={[
                        styles.hue,
                        'themepicker__hue',
                        'rounded-full shadow-[0_0_0_2px_var(--color-content)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-secondary',
                      ]}
                    />
                    <span
                      class:list={[
                        styles.hue,
                        'themepicker__hue',
                        'rounded-full shadow-[0_0_0_2px_var(--color-content)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-spotlight',
                      ]}
                    />
                    <span
                      class:list={[
                        styles.hue,
                        'themepicker__hue',
                        'rounded-full shadow-[0_0_0_2px_var(--color-content)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-content-inverse',
                      ]}
                    />
                    <span
                      class:list={[
                        styles.hue,
                        'themepicker__hue',
                        'rounded-full shadow-[0_0_0_2px_var(--color-content)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-content-offset',
                      ]}
                    />
                    <span
                      class:list={[
                        styles.hue,
                        'themepicker__hue',
                        'rounded-full shadow-[0_0_0_2px_var(--color-content)] inline-block h-6 w-6 overflow-hidden text-left indent-full align-bottom whitespace-nowrap bg-content',
                      ]}
                    />
                  </span>
                </button>
              </li>
            ))
          }
        </ul>
      </div>

      <button
        type="button"
        class="themepicker__navBtn themepicker__navBtn--prev absolute left-0 top-1/2 -translate-y-1/2 -translate-x-2 w-10 h-10 rounded-full bg-content-inverse border-2 border-trim shadow-lg hover:bg-spotlight hover:border-primary transition-all duration-300 flex items-center justify-center z-(--z-raised) disabled:opacity-30 disabled:cursor-not-allowed"
        aria-label="Previous theme"
        data-theme-embla-prev
        hidden
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
          focusable="false"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"
          ></path>
        </svg>
      </button>

      <button
        type="button"
        class="themepicker__navBtn themepicker__navBtn--next absolute right-0 top-1/2 -translate-y-1/2 translate-x-2 w-10 h-10 rounded-full bg-content-inverse border-2 border-trim shadow-lg hover:bg-spotlight hover:border-primary transition-all duration-300 flex items-center justify-center z-(--z-raised) disabled:opacity-30 disabled:cursor-not-allowed"
        aria-label="Next theme"
        data-theme-embla-next
        hidden
      >
        <svg
          class="w-5 h-5"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
          aria-hidden="true"
          focusable="false"
        >
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"
          ></path>
        </svg>
      </button>
    </div>
    <button
      class="themepicker__closeBtn bg-spotlight border-none flex p-1.5 absolute top-0 right-0 transition-all duration-150 ease-in-out hover:bg-spotlight-offset focus:bg-spotlight-offset"
      type="button"
      aria-label="Close theme picker dialog"
      data-theme-close
    >
      <Icon icon={closeComponent} size={8} />
    </button>
  </div>
</theme-picker>

<script>
  import { registerThemePickerWebComponent } from './client'
  import { themeKeyChangeSideEffectsListener } from '@components/scripts/store'
  registerThemePickerWebComponent()
  themeKeyChangeSideEffectsListener()
</script>
