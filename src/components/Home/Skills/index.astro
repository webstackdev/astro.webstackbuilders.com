---
/**
 * "Technologies and Skills" section for the homepage.
 * Renders a dark strip with icon + label links for each technology.
 */
import { type CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'
import Icon from '@components/Icon/index.astro'

export interface Props {
  title: string
  skills: Array<CollectionEntry<'tags'>>
}

const { title, skills } = Astro.props as Props
---

<skills-carousel
  class="block"
  role="region"
  aria-roledescription="carousel"
  aria-labelledby="home-technologies-title"
>
  <h2
    id="home-technologies-title"
    class="font-sans text-lg font-bold text-primary uppercase tracking-widest mb-2"
  >
    {title}
  </h2>
  <div class="bg-content rounded-2xl py-6 px-6" data-skills-embla-root>
    <div class="skills-embla relative">
      <div class="skills-embla__viewport overflow-hidden mx-16 px-5" data-skills-embla-viewport>
        <div class="skills-embla__container flex -mx-5" data-skills-embla-container>
          {skills.map((skill, index) => (
            <div
              class="skills-embla__slide flex-[0_0_auto] min-w-0 pt-1 px-5"
              data-skills-slide
              role="group"
              aria-roledescription="slide"
              aria-label={`${skill.data.displayName} (${index + 1} of ${skills.length})`}
            >
              <a
                href={`/tags/${skill.data.slug}`}
                class="group relative flex flex-col items-center text-center gap-3 text-page-base/60 transition-colors no-underline hover:no-underline focus-visible:no-underline focus-visible:outline-none after:pointer-events-none after:absolute after:inset-0 after:rounded-none after:content-[''] focus-visible:after:border-2 focus-visible:after:border-spotlight shrink-0"
              >
                {skill.data.logo && (
                  <Image
                    src={skill.data.logo}
                    alt={skill.data.displayName}
                    width={skill.data.logo.width}
                    height={32}
                    loading="lazy"
                    class="h-8 w-auto object-contain"
                  />
                )}
                <span class="text-sm text-content-inverse font-semibold transition-colors group-hover:text-content-offset group-focus-visible:text-content-offset">
                  {skill.data.displayName}
                </span>
              </a>
            </div>
          ))}
        </div>
      </div>

      {skills.length > 1 && (
        <>
          <button
            type="button"
            class="embla__button embla__button--prev absolute left-1 top-1/2 -translate-y-1/2 flex h-9 w-9 items-center justify-center rounded-full bg-content hover:bg-content-offset transition-all duration-300 disabled:opacity-30 disabled:cursor-not-allowed focus-visible:outline-none focus-visible:bg-content-offset after:pointer-events-none after:absolute after:-inset-0.5 after:rounded-none after:content-[''] focus-visible:after:border-2 focus-visible:after:border-spotlight"
            data-skills-prev
            aria-label="Previous skill"
          >
            <svg
              class="w-4 h-4 stroke-content-inverse"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
              focusable="false"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="3"
                d="M15 19l-7-7 7-7"
              />
            </svg>
          </button>

          <button
            type="button"
            class="embla__button embla__button--next absolute right-1 top-1/2 -translate-y-1/2 flex h-9 w-9 items-center justify-center rounded-full bg-content hover:bg-content-offset transition-all duration-300 disabled:opacity-30 disabled:cursor-not-allowed focus-visible:outline-none focus-visible:bg-content-offset after:pointer-events-none after:absolute after:-inset-0.5 after:rounded-none after:content-[''] focus-visible:after:border-2 focus-visible:after:border-spotlight"
            data-skills-next
            aria-label="Next skill"
          >
            <svg
              class="w-4 h-4 stroke-content-inverse"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              aria-hidden="true"
              focusable="false"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="3"
                d="M9 5l7 7-7 7"
              />
            </svg>
          </button>
        </>
      )}
    </div>
  </div>

  {skills.length > 1 && (
    <div class="mt-2 flex justify-end pr-2">
      <button
        type="button"
        class:list={[
          "relative flex h-10 w-10 items-center justify-center",
          "bg-content text-content-inverse transition-colors",
          "rounded-full border border-trim",
          "hover:bg-content-active",
          "focus-visible:outline-none focus-visible:bg-content-offset after:pointer-events-none after:absolute after:-inset-1 after:rounded-none after:content-[''] focus-visible:after:border-2 focus-visible:after:border-spotlight"
        ]}
        data-skills-autoplay-toggle
        aria-label="Pause skills"
        aria-pressed="false"
      >
        <span data-skills-icon="pause">
          <Icon name="pause" size={18} class="fill-content-inverse text-content-inverse" />
        </span>
        <span data-skills-icon="play">
          <Icon name="play" size={18} class="fill-content-inverse text-content-inverse" />
        </span>
      </button>
    </div>
  )}
</skills-carousel>

<script>
  import { registerSkillsCarouselWebComponent } from '@components/Home/Skills/client/index'
  registerSkillsCarouselWebComponent()
</script>
