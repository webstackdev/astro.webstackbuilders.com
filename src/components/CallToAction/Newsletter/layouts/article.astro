---
import GDPRConsent from '@components/Consent/Checkbox/index.astro'
import Confetti from '@components/Animations/Confetti/index.astro'
import type { NewsletterProps } from '@components/CallToAction/Newsletter/client/@types'

export type Props = Omit<NewsletterProps, 'variant'>

const {
  title = 'Stay Updated',
  description = 'Subscribe to our newsletter for the latest insights on web development and digital solutions.',
  placeholder = 'Enter your email address',
  buttonText = 'Subscribe',
} = Astro.props
---

<section>
  <div class="bg-content border border-trim rounded-xl p-6 md:p-8 font-mono">
    <div class="flex items-center gap-2 mb-4 pb-4 border-b border-page-base/20">
      <div class="w-3 h-3 rounded-full bg-danger"></div>
      <div class="w-3 h-3 rounded-full bg-warning"></div>
      <div class="w-3 h-3 rounded-full bg-success"></div>
      <span class="text-xs text-page-base/50 ml-2">newsletter.subscribe</span>
    </div>

    <div class="space-y-3">
      <p class="text-page-base">
        <span class="text-success">$</span>
        {` ${title}`}
      </p>
      <p class="text-page-base/70 text-sm">
        <span class="text-page-base/50">&gt;</span>
        {` ${description}`}
      </p>

      <form id="newsletter-form" class="space-y-4">
        <div class="flex gap-3 pt-4">
          <div class="relative flex items-center gap-2 flex-1 after:pointer-events-none after:absolute after:content-[''] after:inset-0 after:rounded-none after:border-2 after:border-transparent focus-within:after:-inset-1 focus-within:after:border-spotlight">
            <span class="text-success">$</span>
            <label id="newsletter-email-label" for="newsletter-email" class="sr-only">
              Email address
            </label>
            <input
              type="email"
              id="newsletter-email"
              name="email"
              placeholder={placeholder}
              class="flex-1 px-3 py-2 bg-page-base/10 border border-page-base/20 rounded text-page-base text-sm placeholder:text-page-base/40 focus:outline-none focus-visible:outline-none"
              required
              aria-describedby="newsletter-message"
            />
          </div>
          <Confetti>
            <button
              type="submit"
              id="newsletter-submit"
              data-e2e-state="idle"
              class="relative px-6 py-2 bg-primary hover:bg-primary-offset text-page-base font-semibold rounded text-sm transition-colors whitespace-nowrap disabled:opacity-50 disabled:cursor-not-allowed focus-visible:outline-none after:pointer-events-none after:absolute after:content-[''] after:inset-0 after:rounded-none after:border-2 after:border-transparent focus-visible:after:-inset-1 focus-visible:after:border-spotlight"
            >
              <span id="button-text">{buttonText}</span>
              <svg
                id="button-arrow"
                class="inline-block w-4 h-4 ml-2"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
                aria-hidden="true"
                focusable="false"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M14 5l7 7m0 0l-7 7m7-7H3"
                ></path>
              </svg>
              <svg
                id="button-spinner"
                class="hidden w-4 h-4 ml-2 animate-spin"
                fill="none"
                viewBox="0 0 24 24"
                aria-hidden="true"
                focusable="false"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                ></circle>
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                ></path>
              </svg>
            </button>
          </Confetti>
        </div>

        <div class="pt-3 border-t border-page-base/20 mt-4">
          <GDPRConsent
            purpose="marketing communications (unsubscribe anytime)"
            id="newsletter-gdpr-consent"
            name="consent"
            formId="newsletter_form"
            variant="newsletter-cta-article"
          />
        </div>

        <p
          id="newsletter-message"
          class="text-xs text-page-base/60 leading-relaxed"
          role="status"
          aria-live="polite"
          aria-atomic="true"
        >
          You'll receive a confirmation email. Click the link to complete your subscription.
        </p>
      </form>
    </div>
  </div>
</section>
