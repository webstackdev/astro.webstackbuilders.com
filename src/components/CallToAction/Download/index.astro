---
/**
 * A lightweight banner/link used to funnel traffic to an existing
 * download page, which is implemented by Forms/Download.
 */
import { BuildError } from '@lib/errors/BuildError'
import List from '@components/List/index.astro'
import Marker from '@components/List/marker.astro'

export interface Props {
  /** Optional base id for internal aria relationships */
  id?: string
  /** Name of the download resource (matches the folder name in content/downloads) */
  resource: string
  /** Main heading for the CTA */
  title?: string
  /** Supporting description text */
  description?: string
  /** Optional List */
  listItems?: {
    text: string
  }[]
  /** Download button text */
  buttonText?: string
  /** Optional secondary action button */
  secondaryLink?: {
    href: string
    text: string
  }
}

const {
  id = 'download-cta',
  resource,
  title = 'Download Our Free Resource',
  description = 'Get instant access to expert insights and actionable strategies.',
  listItems,
  buttonText = 'Download Now',
  secondaryLink = {
    href: "/services/consulting",
    text: "Learn More"
  },
} = Astro.props

const normalizedResource = typeof resource === 'string' ? resource.trim() : ''
if (!normalizedResource) {
  throw new BuildError('CallToAction/Download: resource prop is required')
}

const titleId = `${id}-title`
const descriptionId = `${id}-description`

// Construct the download landing page URL
const downloadUrl = `/downloads/${normalizedResource}`
---

<section
  class="bg-linear-to-br from-primary/5 to-accent/5 border border-primary/20 rounded-2xl p-6 md:p-8"
  aria-labelledby={titleId}
  aria-describedby={descriptionId}
>
  <div class="flex flex-col lg:flex-row gap-8">
    <div class="lg:flex-1">
      <div class="flex items-center gap-2 mb-3">
        <span
          class="inline-flex items-center gap-1 text-xs font-bold text-primary bg-primary/10 px-2.5 py-1 rounded-full"
        >
          <Marker
            icon={"download-document"}
            size={3.5}
          />
          Free PDF Guide
        </span>
      </div>

      <h2 id={titleId} class="text-2xl md:text-3xl font-bold text-content mb-3">
        {title}
      </h2>
      <p id={descriptionId} class="text-base text-content-offset mb-6 max-w-xl">
        {description}
      </p>

      <p class="text-sm font-semibold text-content mb-3">What you'll get:</p>
      {
        listItems && (
          <List
            variant="two-column-check-icons-list"
            items={listItems}
          />
        )
      }
    </div>

    <div class="lg:w-72 lg:shrink-0">
      <div class="bg-content-inverse rounded-xl border border-trim p-5 shadow-sm">
        <div class="text-center mb-4">
          <div class="w-16 h-16 bg-primary/10 rounded-full flex items-center justify-center mx-auto mb-3">
            <Marker
              icon={"document"}
              size={8}
              color={"text-primary"}
            />
          </div>
          <p class="text-xs text-content-offset">Free resource Â· Instant access</p>
        </div>

        <div class="space-y-3">
          <a
            href={downloadUrl}
            class="w-full inline-flex items-center justify-center gap-2 px-6 py-3 bg-spotlight hover:bg-spotlight-offset text-white font-semibold rounded-lg text-sm transition-colors no-underline hover:no-underline focus:no-underline focus-visible:no-underline decoration-transparent hover:decoration-transparent focus:decoration-transparent focus-visible:decoration-transparent"
          >
            <Marker
              icon={"download"}
              size={5}
            />
            {buttonText}
          </a>
          {
            secondaryLink && (
              <a
                href={secondaryLink.href}
                class="w-full inline-flex items-center justify-center px-6 py-3 border border-trim text-content font-semibold rounded-lg text-sm hover:bg-page-offset transition-colors"
              >
                {secondaryLink.text}
              </a>
            )
          }
        </div>

        <p class="text-xs text-content-offset text-center mt-4">No credit card required.</p>
      </div>
    </div>
  </div>
</section>
