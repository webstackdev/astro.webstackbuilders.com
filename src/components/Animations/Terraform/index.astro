---
/**
 * Terraform dependency graph animation for home page Hero.
 * Depicts a `terraform graph` style two-tier dependency tree inside a
 * terminal frame, animated with GSAP to show init → plan → apply workflow.
 */
import Icon from '@components/Icon/index.astro'
---

<terraform-animation class="hidden lg:flex order-1 lg:order-2 justify-center items-start">
  <div class="relative w-full max-w-lg mx-auto flex flex-col items-start">
    <div class="w-full h-auto rounded-2xl">
      <svg
        id="terraformAnimation"
        aria-hidden="true"
        focusable="false"
        xmlns="http://www.w3.org/2000/svg"
        class="block w-full h-auto max-w-full"
        viewBox="0 0 600 600"
        preserveAspectRatio="xMidYMid meet"
        style="visibility: hidden;"
      >
        <defs>
          <filter id="tf-check-glow" x="-50%" y="-50%" width="200%" height="200%">
            <feGaussianBlur in="SourceGraphic" stdDeviation="3" result="blur" />
            <feMerge>
              <feMergeNode in="blur" />
              <feMergeNode in="SourceGraphic" />
            </feMerge>
          </filter>
        </defs>

        <!-- ===== TERMINAL FRAME ===== -->
        <g id="tf-frame">
          <rect id="tf-frame-rect" x="40" y="40" width="520" height="520" rx="10" fill="var(--color-primary)" stroke="var(--color-primary-offset)" stroke-width="2" />
          <rect x="40" y="40" width="520" height="32" rx="10" fill="var(--color-primary-offset)" />
          <rect x="40" y="60" width="520" height="12" fill="var(--color-primary-offset)" />
          <circle cx="62" cy="56" r="5" fill="#dc2626" opacity="0.7" />
          <circle cx="78" cy="56" r="5" fill="var(--color-spotlight)" opacity="0.7" />
          <circle cx="94" cy="56" r="5" fill="var(--color-success)" opacity="0.7" />
          <text x="300" y="61" fill="var(--color-page-base)" font-family="monospace" font-size="11" text-anchor="middle" opacity="0.6">terraform — plan &amp; apply</text>
        </g>

        <!-- ===== ROOT NODE: main.tf ===== -->
        <g id="tf-node-root" transform="translate(300,120)">
          <rect x="-52" y="-18" width="104" height="36" rx="6" fill="var(--color-primary-offset)" stroke="var(--color-content-offset)" stroke-width="1.5" />
          <rect x="-40" y="-10" width="14" height="16" rx="1" fill="none" stroke="var(--color-page-base)" stroke-width="1.2" />
          <polyline points="-32,-10 -32,-6 -26,-6" fill="none" stroke="var(--color-page-base)" stroke-width="1.2" />
          <text id="tf-root-text" x="-18" y="5" fill="var(--color-page-base)" font-family="monospace" font-size="13" font-weight="bold">main.tf</text>
          <g id="tf-check-root" opacity="0" filter="url(#tf-check-glow)">
            <circle cx="60" cy="0" r="8" fill="var(--color-success)" />
            <polyline points="55,0 58,4 65,-4" fill="none" stroke="var(--color-page-base)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </g>
        </g>

        <!-- ===== PRIMARY EDGES (root → row 1) ===== -->
        <g id="tf-edges-primary" fill="none" stroke="var(--color-content-offset)" stroke-width="1.5">
          <path id="tf-edge-vpc" d="M270,138 C270,162 150,162 150,186" />
          <polygon id="tf-arrow-vpc" points="150,186 146,178 154,178" fill="var(--color-content-offset)" />
          <path id="tf-edge-iam" d="M300,138 C300,158 300,166 300,186" />
          <polygon id="tf-arrow-iam" points="300,186 296,178 304,178" fill="var(--color-content-offset)" />
          <path id="tf-edge-s3" d="M330,138 C330,162 450,162 450,186" />
          <polygon id="tf-arrow-s3" points="450,186 446,178 454,178" fill="var(--color-content-offset)" />
        </g>

        <!-- ===== CROSS-DEPENDENCY EDGES (row 1 → row 2) ===== -->
        <g id="tf-edges-cross" fill="none" stroke="var(--color-content-offset)" stroke-width="1" stroke-dasharray="6 3">
          <path id="tf-edge-vpc-eks" d="M150,234 C150,260 210,260 210,286" />
          <polygon id="tf-arrow-vpc-eks" points="210,286 207,279 213,279" fill="var(--color-content-offset)" />
          <path id="tf-edge-iam-eks" d="M300,234 C300,260 210,264 210,286" />
          <polygon id="tf-arrow-iam-eks" points="210,286 207,279 213,279" fill="var(--color-content-offset)" />
          <path id="tf-edge-vpc-rds" d="M175,234 C175,268 370,260 390,286" />
          <polygon id="tf-arrow-vpc-rds" points="390,286 387,279 393,279" fill="var(--color-content-offset)" />
          <path id="tf-edge-iam-rds" d="M320,234 C320,260 390,264 390,286" />
          <polygon id="tf-arrow-iam-rds" points="390,286 387,279 393,279" fill="var(--color-content-offset)" />
        </g>

        <!-- ===== ROW 1: VPC ===== -->
        <g id="tf-node-vpc" transform="translate(150,210)">
          <rect x="-48" y="-24" width="96" height="48" rx="6" fill="var(--color-primary-offset)" stroke="var(--color-content-offset)" stroke-width="1.5" />
          <line x1="-28" y1="-8" x2="-6" y2="-8" stroke="var(--color-page-base)" stroke-width="1" opacity="0.5" />
          <line x1="-28" y1="0" x2="-6" y2="0" stroke="var(--color-page-base)" stroke-width="1" opacity="0.5" />
          <line x1="-28" y1="8" x2="-6" y2="8" stroke="var(--color-page-base)" stroke-width="1" opacity="0.5" />
          <line x1="-22" y1="-14" x2="-22" y2="14" stroke="var(--color-page-base)" stroke-width="1" opacity="0.5" />
          <line x1="-16" y1="-14" x2="-16" y2="14" stroke="var(--color-page-base)" stroke-width="1" opacity="0.5" />
          <line x1="-10" y1="-14" x2="-10" y2="14" stroke="var(--color-page-base)" stroke-width="1" opacity="0.5" />
          <text x="16" y="4" fill="var(--color-page-base)" font-family="monospace" font-size="11">VPC</text>
          <g id="tf-check-vpc" opacity="0" filter="url(#tf-check-glow)">
            <circle cx="54" cy="-14" r="8" fill="var(--color-success)" />
            <polyline points="49,-14 52,-10 59,-18" fill="none" stroke="var(--color-page-base)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </g>
          <rect id="tf-flash-vpc" x="-48" y="-24" width="96" height="48" rx="6" fill="none" stroke="var(--color-success)" stroke-width="2.5" opacity="0" />
        </g>

        <!-- ===== ROW 1: IAM ===== -->
        <g id="tf-node-iam" transform="translate(300,210)">
          <rect x="-48" y="-24" width="96" height="48" rx="6" fill="var(--color-primary-offset)" stroke="var(--color-content-offset)" stroke-width="1.5" />
          <path d="M-18,-14 L-28,-7 L-28,2 C-28,10 -18,16 -18,16 C-18,16 -8,10 -8,2 L-8,-7z" fill="none" stroke="var(--color-page-base)" stroke-width="1.3" stroke-linejoin="round" />
          <polyline points="-22,0 -18,4 -12,-4" fill="none" stroke="var(--color-page-base)" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round" />
          <text x="12" y="4" fill="var(--color-page-base)" font-family="monospace" font-size="11">IAM</text>
          <g id="tf-check-iam" opacity="0" filter="url(#tf-check-glow)">
            <circle cx="54" cy="-14" r="8" fill="var(--color-success)" />
            <polyline points="49,-14 52,-10 59,-18" fill="none" stroke="var(--color-page-base)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </g>
          <rect id="tf-flash-iam" x="-48" y="-24" width="96" height="48" rx="6" fill="none" stroke="var(--color-success)" stroke-width="2.5" opacity="0" />
        </g>

        <!-- ===== ROW 1: S3 ===== -->
        <g id="tf-node-s3" transform="translate(450,210)">
          <rect x="-48" y="-24" width="96" height="48" rx="6" fill="var(--color-primary-offset)" stroke="var(--color-content-offset)" stroke-width="1.5" />
          <path d="M-28,-10 L-24,10 L-8,10 L-4,-10z" fill="none" stroke="var(--color-page-base)" stroke-width="1.3" stroke-linejoin="round" />
          <ellipse cx="-16" cy="-10" rx="12" ry="4" fill="none" stroke="var(--color-page-base)" stroke-width="1.2" />
          <path d="M-27,0 Q-16,4 -5,0" fill="none" stroke="var(--color-page-base)" stroke-width="0.8" opacity="0.5" />
          <text x="16" y="4" fill="var(--color-page-base)" font-family="monospace" font-size="11">S3</text>
          <g id="tf-check-s3" opacity="0" filter="url(#tf-check-glow)">
            <circle cx="54" cy="-14" r="8" fill="var(--color-success)" />
            <polyline points="49,-14 52,-10 59,-18" fill="none" stroke="var(--color-page-base)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </g>
          <rect id="tf-flash-s3" x="-48" y="-24" width="96" height="48" rx="6" fill="none" stroke="var(--color-success)" stroke-width="2.5" opacity="0" />
        </g>

        <!-- ===== ROW 2: EKS ===== -->
        <g id="tf-node-eks" transform="translate(210,310)">
          <rect x="-48" y="-24" width="96" height="48" rx="6" fill="var(--color-primary-offset)" stroke="var(--color-content-offset)" stroke-width="1.5" />
          <circle cx="-18" cy="0" r="6" fill="none" stroke="var(--color-page-base)" stroke-width="1.2" />
          <circle cx="-18" cy="0" r="2.5" fill="var(--color-page-base)" opacity="0.5" />
          <line x1="-18" y1="-6" x2="-18" y2="-12" stroke="var(--color-page-base)" stroke-width="1.2" stroke-linecap="round" />
          <line x1="-12.8" y1="-3" x2="-9" y2="-5.2" stroke="var(--color-page-base)" stroke-width="1.2" stroke-linecap="round" />
          <line x1="-12.8" y1="3" x2="-9" y2="5.2" stroke="var(--color-page-base)" stroke-width="1.2" stroke-linecap="round" />
          <line x1="-18" y1="6" x2="-18" y2="12" stroke="var(--color-page-base)" stroke-width="1.2" stroke-linecap="round" />
          <line x1="-23.2" y1="3" x2="-27" y2="5.2" stroke="var(--color-page-base)" stroke-width="1.2" stroke-linecap="round" />
          <line x1="-23.2" y1="-3" x2="-27" y2="-5.2" stroke="var(--color-page-base)" stroke-width="1.2" stroke-linecap="round" />
          <text x="8" y="4" fill="var(--color-page-base)" font-family="monospace" font-size="11">EKS</text>
          <g id="tf-check-eks" opacity="0" filter="url(#tf-check-glow)">
            <circle cx="54" cy="-14" r="8" fill="var(--color-success)" />
            <polyline points="49,-14 52,-10 59,-18" fill="none" stroke="var(--color-page-base)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </g>
          <rect id="tf-flash-eks" x="-48" y="-24" width="96" height="48" rx="6" fill="none" stroke="var(--color-success)" stroke-width="2.5" opacity="0" />
        </g>

        <!-- ===== ROW 2: RDS ===== -->
        <g id="tf-node-rds" transform="translate(390,310)">
          <rect x="-48" y="-24" width="96" height="48" rx="6" fill="var(--color-primary-offset)" stroke="var(--color-content-offset)" stroke-width="1.5" />
          <ellipse cx="-18" cy="-8" rx="10" ry="5" fill="none" stroke="var(--color-page-base)" stroke-width="1.2" />
          <line x1="-28" y1="-8" x2="-28" y2="8" stroke="var(--color-page-base)" stroke-width="1.2" />
          <line x1="-8" y1="-8" x2="-8" y2="8" stroke="var(--color-page-base)" stroke-width="1.2" />
          <ellipse cx="-18" cy="8" rx="10" ry="5" fill="none" stroke="var(--color-page-base)" stroke-width="1.2" />
          <path d="M-28,0 Q-18,4 -8,0" fill="none" stroke="var(--color-page-base)" stroke-width="0.8" opacity="0.5" />
          <text x="10" y="4" fill="var(--color-page-base)" font-family="monospace" font-size="11">RDS</text>
          <g id="tf-check-rds" opacity="0" filter="url(#tf-check-glow)">
            <circle cx="54" cy="-14" r="8" fill="var(--color-success)" />
            <polyline points="49,-14 52,-10 59,-18" fill="none" stroke="var(--color-page-base)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
          </g>
          <rect id="tf-flash-rds" x="-48" y="-24" width="96" height="48" rx="6" fill="none" stroke="var(--color-success)" stroke-width="2.5" opacity="0" />
        </g>

        <!-- ===== TERMINAL OUTPUT ===== -->
        <g id="tf-terminal" transform="translate(70,370)">
          <line id="tf-separator" x1="-30" y1="-8" x2="490" y2="-8" stroke="var(--color-primary-offset)" stroke-width="1" />
          <g id="tf-term-line-1" opacity="0">
            <text x="0" y="10" fill="var(--color-success)" font-family="monospace" font-size="12">$</text>
            <text x="14" y="10" fill="var(--color-page-base)" font-family="monospace" font-size="12">terraform init</text>
          </g>
          <g id="tf-term-line-2" opacity="0">
            <text x="0" y="28" fill="var(--color-content-offset)" font-family="monospace" font-size="11">Initializing provider plugins...</text>
          </g>
          <g id="tf-term-line-3" opacity="0">
            <text x="0" y="48" fill="var(--color-success)" font-family="monospace" font-size="12">$</text>
            <text x="14" y="48" fill="var(--color-page-base)" font-family="monospace" font-size="12">terraform plan</text>
          </g>
          <g id="tf-term-line-4" opacity="0">
            <text x="0" y="66" fill="var(--color-content-offset)" font-family="monospace" font-size="11">Plan: 5 to add, 0 to change, 0 to destroy.</text>
          </g>
          <g id="tf-term-line-5" opacity="0">
            <text x="0" y="86" fill="var(--color-success)" font-family="monospace" font-size="12">$</text>
            <text x="14" y="86" fill="var(--color-page-base)" font-family="monospace" font-size="12">terraform apply -auto-approve</text>
          </g>
          <g id="tf-term-line-6" opacity="0">
            <text x="0" y="104" fill="var(--color-content-offset)" font-family="monospace" font-size="11">aws_vpc.main: Creating...</text>
          </g>
          <g id="tf-term-line-7" opacity="0">
            <text x="0" y="120" fill="var(--color-content-offset)" font-family="monospace" font-size="11">aws_eks_cluster.platform: Creating...</text>
          </g>
          <g id="tf-term-line-8" opacity="0">
            <text x="0" y="136" fill="var(--color-content-offset)" font-family="monospace" font-size="11">aws_db_instance.primary: Creating...</text>
          </g>
          <g id="tf-term-complete" opacity="0">
            <text x="0" y="162" fill="var(--color-success)" font-family="monospace" font-size="13" font-weight="bold">Apply complete! Resources: 5 added, 0 changed, 0 destroyed.</text>
          </g>
          <rect id="tf-cursor" x="0" y="170" width="8" height="13" rx="1" fill="var(--color-success)" opacity="0" />
        </g>
      </svg>
    </div>
    <button
      type="button"
      class="z-(--z-raised) self-end flex mr-8 -mt-3 h-12 w-12 items-center justify-center rounded-full bg-primary text-primary-inverse transition-colors hover:bg-primary-offset"
      data-animation-toggle
      aria-label="Pause animation"
      aria-pressed="false"
    >
      <span
        data-animation-icon="pause"
        class="flex h-12 w-12 items-center justify-center bg-transparent"
      >
        <Icon name="pause" size={20} variant="custom" class="text-primary-inverse fill-primary-inverse stroke-primary-inverse" />
      </span>
      <span
        data-animation-icon="play"
        class="hidden h-12 w-12 items-center justify-center bg-transparent"
      >
        <Icon name="play" size={20} variant="custom" class="text-primary-inverse fill-primary-inverse stroke-primary-inverse" />
      </span>
    </button>
  </div>
</terraform-animation>

<script>
  import { registerTerraformAnimationWebComponent } from '@components/Animations/Terraform/client'
  registerTerraformAnimationWebComponent()
</script>
