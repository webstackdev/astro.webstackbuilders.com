---
/**
 * Avatar Component
 *
 * Displays an avatar image for a person. If the avatar image exists, it renders
 * the image. If not, it renders a placeholder with the person's initial.
 * The name is automatically normalized (e.g., "Chris Southam" becomes "chris-southam").
 * @example
 * ```astro
 * <Avatar name="Kevin Brown" />
 * <Avatar name="Chris Southam" class="custom-class" />
 * ```
 */

import { Image } from 'astro:assets'
import { AvatarManager, normalizeNameToFilename } from './avatars'

export interface Props {
  /** The person's name (will be normalized for filename lookup) */
  name: string
  /** Optional: Additional CSS classes */
  class?: string
}

const { name, class: className = '' } = Astro.props

const normalizedFilename = normalizeNameToFilename(name)

// Get the avatar image if it exists
const avatarImage = AvatarManager.getInstance().getAvatar(normalizedFilename)

// If no avatar image and no name for fallback, render nothing
if (!avatarImage && !name) {
  return null
}

const avatarAlt = `Photo of ${name}`
const fallbackInitial = name.charAt(0).toUpperCase()
---

<div class:list={['avatar-container', className]}>
  {avatarImage ? (
    <Image
      src={avatarImage}
      alt={avatarAlt}
      loading="lazy"
      class="avatar-image"
      width={avatarImage.width}
      height={avatarImage.height}
    />
  ) : (
    <div class="avatar-placeholder bg-[color:var(--color-bg-offset)] w-16 h-16 rounded-full flex items-center justify-center text-[color:var(--color-text-offset)]">
      {fallbackInitial}
    </div>
  )}
</div>
