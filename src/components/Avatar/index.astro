---
/**
 * Avatar Component
 *
 * Displays an avatar image for a person. If the avatar image exists, it renders
 * the image. If not, it renders a placeholder with the person's initial.
 * The name is automatically normalized (e.g., "Chris Southam" becomes "chris-southam").
 * @example
 * ```astro
 * <Avatar name="Kevin Brown" />
 * <Avatar name="Chris Southam" class="custom-class" />
 * ```
 */
import { Image } from 'astro:assets'
import {
  AvatarManager,
  normalizeNameToFilename,
  getFallbackInitials,
} from '@components/Avatar/server'

export interface Props {
  /** The person's name (will be normalized for filename lookup) */
  name: string
  /** When true, renders a 40x40 lead avatar */
  lead?: boolean
  /** Optional: Additional CSS classes */
  class?: string
}

const { name, lead = false, class: className = '' } = Astro.props

const normalizedFilename = normalizeNameToFilename(name)

// Get the avatar image if it exists
const avatarImage = AvatarManager.getInstance().getAvatar(normalizedFilename)

// If no avatar image and no name for fallback, render nothing
if (!avatarImage && !name) {
  return null
}

const avatarAlt = name

const avatarSizeClass = lead ? 'w-10 h-10' : 'w-16 h-16'
---

<div class:list={['avatar-container', avatarSizeClass, 'rounded-full overflow-hidden', className]}>
  {
    avatarImage ? (
      <Image
        src={avatarImage}
        alt={avatarAlt}
        loading="lazy"
        class="avatar-image w-full h-full object-cover"
        width={avatarImage.width}
        height={avatarImage.height}
      />
    ) : (
      <div
        class:list={[
          'avatar-placeholder',
          'bg-spotlight',
          avatarSizeClass,
          'rounded-full flex items-center justify-center text-content-offset',
        ]}
        role="img"
        aria-label={name}
      >
        <span aria-hidden="true">{getFallbackInitials(name)}</span>
      </div>
    )
  }
</div>
