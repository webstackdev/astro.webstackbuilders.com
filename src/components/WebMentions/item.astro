---
/**
 * Individual WebMention item display
 */
import { Image } from 'astro:assets'
import type { Webmention } from '@components/WebMentions/@types'
import { buildAvatarImageProps } from './server/avatarImage'

export interface Props {
  mention: Webmention
}

const { mention } = Astro.props

// Format date
const formatDate = (dateString: string) => {
  const date = new Date(dateString)
  return new Intl.DateTimeFormat('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
  }).format(date)
}
---

<article
  class="p-4 bg-content-inverse-offset rounded-lg border border-border h-cite"
  id={`webmention-${mention['wm-id']}`}
>
  <div
    class="flex items-start justify-between gap-4 mb-3 flex-wrap flex-col sm:flex-nowrap sm:flex-row sm:items-center"
  >
    {
      mention.author ? (
        <a
          class="inline-flex items-center gap-3 no-underline text-text transition-colors hover:text-primary-hover p-author h-card u-url"
          href={mention.author.url || mention['wm-source']}
          target="_blank"
          rel="noopener noreferrer"
        >
          <Image
            {...buildAvatarImageProps(mention.author.photo)}
            alt={mention.author.name || 'Anonymous'}
            aria-hidden="true"
            class="w-10 h-10 rounded-full object-cover border-2 border-border u-photo"
            loading="lazy"
            decoding="async"
          />
          <strong class="font-semibold p-name">{mention.author.name}</strong>
        </a>
      ) : (
        <span class="inline-flex items-center gap-3">
          <Image
            {...buildAvatarImageProps()}
            alt="Anonymous"
            aria-hidden="true"
            class="w-10 h-10 rounded-full object-cover border-2 border-border"
            loading="lazy"
            decoding="async"
          />
          <strong class="font-semibold">Anonymous</strong>
        </span>
      )
    }

    {
      mention.published && (
        <time
          class="text-text-offset text-sm whitespace-nowrap dt-published"
          datetime={mention.published}
        >
          {formatDate(mention.published)}
        </time>
      )
    }
  </div>

  {
    mention.content?.value && (
      <div
        class="text-text leading-relaxed wrap-break-word [&_p]:my-2 [&_a]:text-primary [&_a]:underline [&_a:hover]:text-primary-hover p-content"
        set:html={mention.content.value}
      />
    )
  }
</article>
