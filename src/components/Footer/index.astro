---
import contactData from '@content/contact.json'
import { getSiteUrl } from '@components/scripts/utils/siteUrlClient'
import { formatPhoneNumber } from '@components/Footer/server'
import Avatar from '@components/Avatar/index.astro'
import BugReporter from '@components/BugReporter/index.astro'
import Icon from '@components/Icon/index.astro'
import styles from './footer.module.css'

const year = new Date().getFullYear()
---

<site-footer transition:persist>
  <footer class="bg-page-offset w-full mt-6 pt-4" role="contentinfo">
    <div
      id="footer-inner"
      class:list={[
        styles.footerGrid,
        'flex flex-col px-4 sm:px-6 lg:px-8 pb-3',
      ]}
    >
      {/* Page footer company contact */}
      <div class:list={[styles.footerContact, 'mt-3 sm:mt-0 sm:flex sm:items-start sm:pt-6']}>
        {/* Mobile: avatar and company name in same row, Desktop: avatar on left side */}
        <div class="flex items-center sm:block">
          <div class="mr-3 w-16">
            <Avatar name="Kevin Brown" />
          </div>
          <h2 class="text-2xl font-bold sm:hidden">{contactData.company.name}</h2>
        </div>
        <address class="text-base mt-3 sm:mt-0">
          {/* Desktop: show company name here */}
          <h2 class="hidden sm:block text-2xl font-bold">{contactData.company.name}</h2>
          <div class="mt-2 sm:ml-1">
            <p>{contactData.company.address}</p>
            <p>
              {contactData.company.city}, {contactData.company.state}
              {contactData.company.index}
            </p>
          </div>
          <p class="hyphens-none">
            <a
              href={`mailto:${contactData.company.email}`}
              class="hover:text-secondary hover:decoration-secondary focus:text-secondary focus:decoration-secondary"
            >
              {contactData.company.email}
            </a>
          </p>
          <p itemprop="telephone">
            <a
              href={`tel:${contactData.company.telephoneTollFree}`}
              rel="nofollow"
              class="hover:text-secondary hover:decoration-secondary focus:text-secondary focus:decoration-secondary"
            >
              Toll Free {formatPhoneNumber(contactData.company.telephoneTollFree)}
            </a>
          </p>
          <p itemprop="telephone">
            <a
              href={`tel:${contactData.company.telephoneLocal}`}
              rel="nofollow"
              class="hover:text-secondary hover:decoration-secondary focus:text-secondary focus:decoration-secondary"
            >
              Local {formatPhoneNumber(contactData.company.telephoneLocal)}
            </a>
          </p>
        </address>
      </div>

      {/* "Hire Me" block with current month and year set by script */}
      <div class:list={[styles.footerHireMe, 'hidden lg:block']}>
        <a
          href="/contact"
          id="page-footer__hire-me-anchor"
          class:list={[
            styles.footerHireMeAnchor,
            "hidden uppercase hover:text-secondary focus:text-secondary after:ml-1 after:content-['>']",
          ]}
          aria-label="Available Now. Hire Me"
        >
          Available Now. Hire Me
        </a>
      </div>

      {/* Page footer Social Share links */}
      <nav class={styles.footerSocial} aria-label="Social links">
        <ul class:list={[styles.footerSocialList, 'mt-4 sm:m-0 p-0 list-none']}>
          {
            contactData.company.social
              .sort((a, b) => a.order - b.order)
              .map(social => (
                <li class:list={[styles.footerSocialItem, 'list-none']}>
                  <a
                    href={social.url}
                    title={social.displayName}
                    rel="me"
                    class:list={[
                      styles.footerSocialLink,
                      'group flex flex-col hover:text-secondary focus:text-secondary',
                    ]}
                  >
                    <span class:list={[styles.footerSocialHeaderRow, 'flex items-baseline']}>
                      <span class={styles.footerSocialIcon}>
                        <Icon icon={social.iconName} color="inherit" />
                      </span>
                      <span class:list={[styles.footerSocialPlatform, 'ml-2 mt-4 uppercase']}>
                        {social.displayName}
                      </span>
                    </span>
                    <span class:list={[styles.footerSocialBlurb, 'font-serif leading-tight']}>
                      <span class={styles.footerSocialBlurbText}>
                        {social.blurb}
                      </span>
                    </span>
                  </a>
                </li>
              ))
          }
        </ul>
      </nav>

      <div class:list={[styles.footerBottomRow, 'mt-4 px-1 pt-4 pb-3 sm:p-0 lg:pl-8']}>
        <div class={styles.footerBottomGrid}>
          <div class={styles.footerBottomPrimary}>
            {/* Page footer Subscribe link */}
            <a
              href="/#newsletter"
              class:list={[
                styles.footerBottomLink,
                'group',
              ]}
            >
              <div class="lg:hidden">Subscribe to</div>
              <span class={styles.footerBottomLinkTitle}>Mailing List</span>
              <span class:list={[styles.footerBottomLinkDescription, 'hidden lg:block']}>
                <span class={styles.footerBottomLinkDescriptionText}>
                  Sign up to stay in touch and get great content
                </span>
              </span>
            </a>
          </div>

          <div class={styles.footerBottomSecondary}>
            {/* Page footer Consent link */}
            <a
              href="/consent"
              class:list={[
                styles.footerBottomLink,
                'group',
              ]}
            >
              <span class={styles.footerBottomLinkTitle}>Consent</span>
              <span class:list={[styles.footerBottomLinkDescription, 'hidden lg:block']}>
                <span class={styles.footerBottomLinkDescriptionText}>
                  Manage your privacy preferences and data consent
                </span>
              </span>
            </a>

            {/* Page footer Privacy Policy link */}
            <a
              href="/privacy"
              class:list={[
                styles.footerBottomLink,
                'group',
              ]}
            >
              <span class={styles.footerBottomLinkTitle}>Privacy Policy</span>
              <span class:list={[styles.footerBottomLinkDescription, 'hidden lg:block']}>
                <span class={styles.footerBottomLinkDescriptionText}>
                  Learn what data we collect and how we use it
                </span>
              </span>
            </a>
          </div>

          <div class={styles.footerBottomActions}>
            {/* Page footer RSS link */}
            <a
              href={`${getSiteUrl()}/rss.xml`}
              title="RSS Feed"
              class:list={[
                styles.footerFeedIcon,
                styles.footerIconButton,
              ]}
            >
              <span class="sr-only">RSS Feed</span>
              <Icon icon="feed" color="inherit" />
            </a>

            {/* Page footer Bug Reporter trigger */}
            <button
              id="bugReporterTrigger"
              type="button"
              title="Report a bug"
              class:list={[
                styles.footerFeedIcon,
                styles.footerIconButton,
              ]}
            >
              <span class="sr-only">Report a bug</span>
              <Icon icon="bug" color="inherit" />
            </button>
          </div>
        </div>
      </div>

      {/* Page footer Author link and Date */}
      <div class:list={[styles.footerCopyright, 'flex justify-center py-4 sm:p-0 lg:mt-4']}>
        <span>
          &copy; 2018&ndash;{year}
        </span>
        <span class="ml-4">
          <a
            rel="me"
            href={getSiteUrl()}
            class="hover:text-secondary hover:decoration-secondary focus:text-secondary focus:decoration-secondary"
          >
            {contactData.company.name}
          </a>
        </span>
      </div>

      <BugReporter triggerId="bugReporterTrigger" />
    </div>
  </footer>
</site-footer>
<script>
  import { registerFooterWebComponent } from '@components/Footer/client'
  registerFooterWebComponent()
</script>
