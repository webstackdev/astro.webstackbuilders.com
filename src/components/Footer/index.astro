---
import contactData from '@content/contact.json'
import { getSiteUrl } from '@components/scripts/utils/siteUrlClient'
import { formatPhoneNumber } from '@components/Footer/server'
import Avatar from '@components/Avatar/index.astro'
import BugReporter from '@components/BugReporter/index.astro'
import Icon from '@components/Icon/index.astro'
import styles from './footer.module.css'

const year = new Date().getFullYear()
const socialLinkClasses = [
  'flex',
  'flex-col',
  'group',
  'no-underline',
  'focus-visible:outline-2',
  'focus-visible:outline-spotlight',
  'focus-visible:outline-offset-2',
  '[&_[data-icon]]:fill-content',
  '[&_[data-icon]]:stroke-content',
  '[&_[data-icon=\'x\']_path]:stroke-none',
  '[&_[data-icon=\'x\']_.xTile]:fill-content',
  '[&_[data-icon=\'x\']_.xGlyph]:fill-content-inverse',
  'focus-visible:text-secondary',
  'hover:text-secondary',
  'focus-visible:[&_[data-icon=\'x\']_.xTile]:fill-secondary',
  'focus-visible:[&_[data-icon]]:fill-secondary',
  'focus-visible:[&_[data-icon]]:stroke-secondary',
  'hover:[&_[data-icon=\'x\']_.xTile]:fill-secondary',
  'hover:[&_[data-icon]]:fill-secondary',
  'hover:[&_[data-icon]]:stroke-secondary',
].join(' ')
const iconButtonClasses = [
  'inline-flex',
  'justify-center',
  'leading-none',
  'p-1',
  'text-content',
  'cursor-pointer',
  'focus-visible:outline-2',
  'focus-visible:outline-spotlight',
  'focus-visible:outline-offset-2',
  '[&_[data-icon]]:h-8',
  '[&_[data-icon]]:w-8',
  '[&_[data-icon]]:fill-current',
  '[&_[data-icon]]:stroke-current',
  'focus-visible:text-secondary',
  'hover:text-secondary',
].join(' ')
---

<site-footer transition:persist>
  <footer class="w-full bg-page-offset mt-6 pt-4" role="contentinfo">
    <div
      id="footer-inner"
      class:list={[
        styles.footerGrid,
        'flex flex-col pb-3 px-4 sm:grid sm:gap-x-4 sm:gap-y-2 sm:px-6 lg:px-8',
      ]}
    >
      {/* Page footer company contact */}
      <div
        class:list={[styles.footerContact, 'mt-3 sm:mt-0 sm:flex sm:items-start sm:pt-6']}
      >
        {/* Mobile: avatar and company name in same row, Desktop: avatar on left side */}
        <div class="flex items-center sm:block">
          <div class="mr-3 w-16">
            <Avatar name="Kevin Brown" />
          </div>
          <h2 class="font-bold text-2xl sm:hidden">{contactData.company.name}</h2>
        </div>
        <address class="mt-3 text-base sm:mt-0">
          {/* Desktop: show company name here */}
          <h2 class="hidden font-bold text-2xl sm:block">{contactData.company.name}</h2>
          <div class="mt-2 sm:ml-1">
            <p>{contactData.company.address}</p>
            <p>
              {contactData.company.city}, {contactData.company.state}
              {contactData.company.index}
            </p>
          </div>
          <p class="hyphens-none">
            <a
              href={`mailto:${contactData.company.email}`}
              class:list={[
                'hover:text-secondary hover:decoration-secondary focus:text-secondary focus:decoration-secondary',
                'focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2',
              ]}
            >
              {contactData.company.email}
            </a>
          </p>
          <p itemprop="telephone">
            <a
              href={`tel:${contactData.company.telephoneTollFree}`}
              rel="nofollow"
              class:list={[
                'hover:text-secondary hover:decoration-secondary focus:text-secondary focus:decoration-secondary',
                'focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2',
              ]}
            >
              Toll Free {formatPhoneNumber(contactData.company.telephoneTollFree)}
            </a>
          </p>
          <p itemprop="telephone">
            <a
              href={`tel:${contactData.company.telephoneLocal}`}
              rel="nofollow"
              class:list={[
                'hover:text-secondary hover:decoration-secondary focus:text-secondary focus:decoration-secondary',
                'focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2',
              ]}
            >
              Local {formatPhoneNumber(contactData.company.telephoneLocal)}
            </a>
          </p>
        </address>
      </div>

      {/* "Hire Me" block with current month and year set by script */}
      <div class:list={[styles.footerHireMe, 'hidden lg:block lg:self-end lg:mt-8']}>
        <a
          href="/contact"
          id="page-footer__hire-me-anchor"
          class:list={[
            styles.footerHireMeAnchor,
            "hidden mt-2 uppercase no-underline focus:text-secondary hover:text-secondary after:ml-1 after:content-['>']",
            'focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2',
          ]}
          aria-label="Available Now. Hire Me"
        >
          Available Now. Hire Me
        </a>
      </div>

      {/* Page footer Social Share links */}
      <nav class:list={["mt-5", styles.footerSocial]} aria-label="Social links">
        <ul class="grid list-none gap-x-4 gap-y-3 p-0 sm:mb-0 sm:mt-0 sm:mx-0 lg:grid-cols-2">
          {
            contactData.company.social
              .sort((a, b) => a.order - b.order)
              .map(social => (
                <li class="list-none">
                  <a
                    href={social.url}
                    title={social.displayName}
                    rel="me"
                    class={socialLinkClasses}
                  >
                    <span class="flex items-center">
                      <span class="**:data-icon:h-8 **:data-icon:w-8">
                        <Icon icon={social.iconName} color="inherit" size={8} />
                      </span>
                      <span class="ml-2 uppercase underline decoration-primary decoration-dotted underline-offset-4 group-focus-visible:decoration-secondary group-hover:decoration-secondary">
                        {social.displayName}
                      </span>
                    </span>
                    <span class="mt-1 leading-tight font-serif">
                      <span class="no-underline text-content">
                        {social.blurb}
                      </span>
                    </span>
                  </a>
                </li>
              ))
          }
        </ul>
      </nav>

      <div
        class:list={[
          styles.footerBottomRow,
          'mt-4 px-1 pt-4 pb-3 sm:p-0',
          'lg:pl-8',
        ]}
      >
        <div class="grid grid-cols-2 gap-x-4 gap-y-3 lg:grid-cols-1">
          <div class={styles.footerBottomPrimary}>
            {/* Page footer Subscribe link */}
            <a
              href="/newsletter"
              class="no-underline group focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2"
            >
              <span class="underline decoration-dotted group-focus-visible:decoration-secondary group-hover:decoration-secondary">
                Mailing List
              </span>
              <span class="hidden no-underline lg:block">
                <span class="text-content">
                  Sign up to stay in touch and get great content
                </span>
              </span>
            </a>
          </div>

          <div class:list={[styles.footerBottomSecondary, 'flex flex-col gap-3']}>
            {/* Page footer Consent link */}
            <a
              href="/consent"
              class="no-underline group focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2"
            >
              <span class="underline decoration-dotted group-focus-visible:decoration-secondary group-hover:decoration-secondary">
                Consent
              </span>
              <span class="hidden no-underline lg:block">
                <span class="text-content">
                  Manage your privacy preferences and data consent
                </span>
              </span>
            </a>

            {/* Page footer Privacy Policy link */}
            <a
              href="/privacy"
              class="no-underline group focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2"
            >
              <span class="underline decoration-dotted group-focus-visible:decoration-secondary group-hover:decoration-secondary">
                Privacy Policy
              </span>
              <span class="hidden no-underline lg:block">
                <span class="text-content">
                  Learn what data we collect and how we use it
                </span>
              </span>
            </a>
          </div>

          <div class:list={[styles.footerBottomActions, 'flex items-center justify-center gap-4']}>
            {/* Page footer RSS link */}
            <a
              href={`${getSiteUrl()}/rss.xml`}
              title="RSS Feed"
              class={iconButtonClasses}
            >
              <span class="sr-only">RSS Feed</span>
              <Icon icon="feed" color="inherit" size={8} />
            </a>

            {/* Page footer Bug Reporter trigger */}
            <button
              id="bugReporterTrigger"
              type="button"
              title="Report a bug"
              class={iconButtonClasses}
            >
              <span class="sr-only">Report a bug</span>
              <Icon icon="bug" color="inherit" size={8} />
            </button>
          </div>
        </div>
      </div>

      {/* Page footer Author link and Date */}
      <div class:list={[styles.footerCopyright, 'flex justify-center py-4 sm:p-0 lg:mt-4']}>
        <span>
          &copy; 2018&ndash;{year}
        </span>
        <span class="ml-4">
          <a
            rel="me"
            href={getSiteUrl()}
            class:list={[
              'hover:text-secondary hover:decoration-secondary focus:text-secondary focus:decoration-secondary',
              'focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2',
            ]}
          >
            {contactData.company.name}
          </a>
        </span>
      </div>

      <BugReporter triggerId="bugReporterTrigger" />
    </div>
  </footer>
</site-footer>
<script>
  import { registerFooterWebComponent } from '@components/Footer/client'
  registerFooterWebComponent()
</script>
