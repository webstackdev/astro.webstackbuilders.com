---
import Icon from '@components/Icon/index.astro'
import List from '@components/List/index.astro'
import UnsavedConsentDialog from '@components/Pages/Consent/unsaved.astro'
import HeadingAnchor from '@components/Layout/HeadingAnchor/index.astro'

export type Props = {
  content: {
    header: {
      title: string
      description: string
    }
    intro: string
    introLinks: {
      privacyPolicyText: string
      myDataText: string
    }
    essential: {
      heading: string
      subheading: string
      buttonText: string
      description: string
    }
    analytics: {
      heading: string
      subheading: string
      description: string
    }
    functional: {
      heading: string
      subheading: string
      description: string
      trailer: string
    }
    marketing: {
      heading: string
      subheading: string
      description: string
    }
    buttons: {
      save: string
      acceptAll: string
      rejectAll: string
    },
    cookies: {
      heading: string
      subheading: string
      description: string
      types: {
        title: string
        text: string
        icon: string
        color: string
        bgColor?: string
      }[]
    }
    management: {
      heading: string
      subheading: string
      types: {
        name: string
        description: string
        icon: string
      }[]
    }
    questions: {
      heading: string
      subheading: string
      methods: {
        lead: string
        description: string
        link: string
        icon: string
      }[]
    }
  }
}

const { content } = Astro.props
---

<div class="max-w-4xl mx-auto w-full block py-2 md:py-4">
  <header class="text-center max-w-2xl mx-auto mb-2">
    <div class="inline-flex items-center justify-center w-18 h-18 rounded-full bg-primary/10 mb-5">
      <Icon
        icon="lock"
        color="page-inverse"
        size={12}
      />
    </div>
    <h1 class="font-bold text-page-inverse mb-4">{content.header.title}</h1>
    <p class="text-lg text-content-offset leading-relaxed">
      {content.header.description}
    </p>
  </header>

  <consent-preferences class="mb-2">
    <section
      aria-labelledby="consent-preferences__title"
      aria-describedby="consent-preferences__settings-desc"
    >
      <div class="px-6 pt-8 pb-2">
        {/* Introduction */}
        <div class="bg-page-offset rounded-xl p-6 mb-4">
          <p class="leading-relaxed text-md">{content.intro}</p>
          <div class="mt-4 flex justify-evenly">
            <a
              href="/privacy"
              class="text-page-inverse underline decoration-page-inverse decoration-dotted underline-offset-4 hover:text-secondary hover:decoration-secondary focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2"
            >
              {content.introLinks.privacyPolicyText}
            </a>
            <a
              href="/privacy/my-data"
              class="text-page-inverse underline decoration-page-inverse decoration-dotted underline-offset-4 hover:text-secondary hover:decoration-secondary focus-visible:outline-2 focus-visible:outline-spotlight focus-visible:outline-offset-2"
            >
              {content.introLinks.myDataText}
            </a>
          </div>
        </div>

        {/* Data Storage Categories */}
        <div class="space-y-6">
          {/* Essential Data */}
          <div class="bg-page-offset rounded-xl p-6">
            <div class="flex items-center justify-between mb-1">
              <div>
                <h3 class="text-xl font-semibold text-primary-offset">{content.essential.heading}</h3>
              </div>
              <div class="flex items-center">
                <span
                  class="text-sm text-green-600 dark:text-green-400 font-medium bg-green-100 dark:bg-green-900/30 px-3 py-1 rounded-full"
                >
                  {content.essential.buttonText}
                </span>
              </div>
            </div>
            <p class="text-sm text-content-offset mb-3">{content.essential.subheading}</p>
            <p class="text-content text-md leading-relaxed">{content.essential.description}</p>
          </div>

          {/* Performance and Analytics */}
          <div class="bg-page-offset rounded-xl p-6">
            <div class="flex items-center justify-between mb-1">
              <div>
                <h3 class="text-xl font-semibold text-primary-offset">{content.analytics.heading}</h3>
              </div>
              <label
                class="relative inline-flex items-center cursor-pointer"
                data-consent-toggle="analytics-cookies"
              >
                <input
                  type="checkbox"
                  id="analytics-cookies"
                  class="sr-only peer"
                  role="switch"
                  aria-labelledby="consent-preferences__analytics-title"
                  aria-describedby="consent-preferences__analytics-desc"
                  checked
                />
                <div
                  class="w-11 h-6 bg-content peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                >
                </div>
              </label>
            </div>
            <p class="text-sm text-content-offset mb-3">{content.analytics.subheading}</p>
            <p class="text-content text-md leading-relaxed">{content.analytics.description}</p>
          </div>

          {/* Functional */}
          <div class="bg-page-offset rounded-xl p-6">
            <div class="flex items-center justify-between mb-1">
              <div>
                <h3 class="text-xl font-semibold text-primary-offset">{content.functional.heading}</h3>
              </div>
              <label
                class="relative inline-flex items-center cursor-pointer"
                data-consent-toggle="functional-cookies"
              >
                <input
                  type="checkbox"
                  id="functional-cookies"
                  class="sr-only peer"
                  role="switch"
                  aria-labelledby="consent-preferences__functional-title"
                  aria-describedby="consent-preferences__functional-desc"
                />
                <div
                  class="w-11 h-6 bg-content peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                >
                </div>
              </label>
            </div>
            <p class="text-sm text-content-offset mb-3">{content.functional.subheading}</p>
            <p class="text-content text-md leading-relaxed">{content.functional.description}</p>
            <div class="bg-content-inverse-active rounded-lg p-4 mt-4 -mx-1">
              <p class="text-sm text-secondary leading-relaxed" set:html={content.functional.trailer}></p>
            </div>
          </div>

          {/* Marketing */}
          <div class="bg-page-offset rounded-xl p-6">
            <div class="flex items-center justify-between mb-1">
              <div>
                <h3 class="text-xl font-semibold text-primary-offset">{content.marketing.heading}</h3>
              </div>
              <label
                class="relative inline-flex items-center cursor-pointer"
                data-consent-toggle="marketing-cookies"
              >
                <input
                  type="checkbox"
                  id="marketing-cookies"
                  class="sr-only peer"
                  role="switch"
                  aria-labelledby="consent-preferences__marketing-title"
                  aria-describedby="consent-preferences__marketing-desc"
                />
                <div
                  class="w-11 h-6 bg-content peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-0.5 after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
                >
                </div>
              </label>
            </div>
            <p class="text-sm text-content-offset mb-3">{content.marketing.subheading}</p>
            <p class="text-content text-md leading-relaxed">{content.marketing.description}</p>
          </div>
        </div>
      </div>

      <div class="px-6 py-4 flex gap-3 justify-end flex-wrap">
        <button
          id="consent-allow-all"
          class="px-6 py-2 bg-spotlight text-white rounded-lg hover:bg-spotlight-offset transition-colors duration-200 font-medium"
        >
          {content.buttons.acceptAll}
        </button>
        <button
          id="consent-deny-all"
          class="px-6 py-2 bg-spotlight rounded-lg hover:bg-spotlight-offset transition-colors duration-200 font-medium"
        >
          {content.buttons.rejectAll}
        </button>
        <button
          id="consent-save-preferences"
          class="px-6 py-2 bg-gray-300 text-white rounded-lg hover:bg-gray-300 cursor-not-allowed transition-colors duration-200 font-medium"
          disabled
          aria-disabled="true"
        >
          {content.buttons.save}
        </button>
      </div>
    </section>
  </consent-preferences>

  <!-- Cookie Information -->
  <div class="prose prose-lg dark:prose-invert max-w-none">
    <section class="mb-12" aria-labelledby="consent-what-are-cookies-title">
      <h2
        id="consent-what-are-cookies-title"
        class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-6"
      >
        {content.cookies.heading}
        <HeadingAnchor href={"#consent-what-are-cookies-title"} />
      </h2>
      <div class="bg-blue-50 dark:bg-blue-900/20 rounded-xl p-6">
        <p class="text-gray-600 dark:text-gray-300 mb-4">
          {content.cookies.description}
        </p>
        <List
          variant="two-column-icon-list"
          items={content.cookies.types}
          size={4}
          classes={{
            ul: "mt-6",
            icon: "w-8 h-8 bg-blue-100 mr-4",
          }}
        />
      </div>
    </section>

    <section class="mb-12" aria-labelledby="consent-managing-cookies-title">
      <h2
        id="consent-managing-cookies-title"
        class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-6"
      >
        {content.management.heading}
        <HeadingAnchor href={"#consent-managing-cookies-title"} />
      </h2>
      <p class="text-gray-600 dark:text-gray-300 mb-6">
        {content.management.subheading}
      </p>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {content.management.types.map((item) => {
          return (
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
              <div
                class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mb-4"
              >
                <Icon
                  icon={item.icon}
                  color="blue-600"
                  size={6}
                />
              </div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">{item.name}</h3>
              <p class="text-gray-600 dark:text-gray-300 text-sm">
                {item.description}
              </p>
            </div>
          )
        })}
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
          <div
            class="w-12 h-12 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center mb-4"
          >
            <svg
              class="w-6 h-6 text-orange-600 dark:text-orange-400"
              aria-hidden="true"
              focusable="false"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 21a9.004 9.004 0 008.716-6.747M12 21a9.004 9.004 0 01-8.716-6.747M12 21c2.485 0 4.5-4.03 4.5-9S14.485 3 12 3s-4.5 4.03-4.5 9 2.015 9 4.5 9z"
              ></path>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Firefox</h3>
          <p class="text-gray-600 dark:text-gray-300 text-sm">
            Options → Privacy & Security → Cookies and Site Data
          </p>
        </div>
        <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-md">
          <div
            class="w-12 h-12 bg-gray-100 dark:bg-gray-700 rounded-lg flex items-center justify-center mb-4"
          >
            <svg
              class="w-6 h-6 text-gray-600 dark:text-gray-400"
              aria-hidden="true"
              focusable="false"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
              ></path>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">Safari</h3>
          <p class="text-gray-600 dark:text-gray-300 text-sm">
            Preferences → Privacy → Manage Website Data
          </p>
        </div>
      </div>
    </section>

    <section class="mb-12" aria-labelledby="consent-contact-title">
      <h2
        id="consent-contact-title"
        class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-6"
      >
        {content.questions.heading}
        <HeadingAnchor href={"#consent-contact-title"} />
      </h2>
      <div class="bg-gray-50 dark:bg-gray-800 rounded-xl p-6">
        <p class="text-gray-600 dark:text-gray-300 mb-4">
          {content.questions.subheading}
        </p>
        <div class="flex items-start">
          {content.questions.methods.map((item) => {
            return (
              <div
                class="w-8 h-8 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center mr-4 shrink-0"
              >
                <Icon
                  icon={item.icon}
                  color="blue-600"
                  size={4}
                />
              </div>
              <div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-1">{item.lead}</h3>
                <a href={item.link} class="text-blue-600 dark:text-blue-400 hover:underline">
                  {item.description}
                </a>
              </div>
            )
          })}
        </div>
      </div>
    </section>
  </div>
</div>

<UnsavedConsentDialog />

<!-- Privacy Preferences Management Script -->
<script>
  import { registerConsentPreferencesWebComponent } from '@components/Pages/Consent/client'
  registerConsentPreferencesWebComponent()
</script>
