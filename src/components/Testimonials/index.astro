---
// Testimonials component for displaying client testimonials
import { getCollection } from 'astro:content'
import Avatar from '@components/Avatar/index.astro'

export interface Props {
  title?: string
  limit?: number
}

const {
  title = "Testimonials",
  limit
} = Astro.props

// Get all testimonials from content collection
const allTestimonials = await getCollection('testimonials')

// Sort by publishDate (newest first) and apply limit if specified
const testimonials = allTestimonials
  .sort((a, b) => new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime())
  .slice(0, limit || allTestimonials.length)
---

<div class="mod-testimonials">
  <!-- TODO: Consider using Glide for carousels: A dependency-free JavaScript ES6 slider and carousel. -->
  <!-- https://glidejs.com/ -->
  <h1 class="mod-testimonials__header">{title}</h1>
  <ul class="mod-testimonials__items-container">
    {testimonials.map((testimonial) => {
      return (
        <li class="mod-testimonials__item">
          <div class="mod-testimonials__item-name">{testimonial.data.name}</div>
          <div class="mod-testimonials__item-organization">{testimonial.data.organization}</div>
          <div class="mod-testimonials__item-content">
            {testimonial.body}
          </div>
          <Avatar
            name={testimonial.data.name}
            class="mod-testimonials__item-avatar"
          />
        </li>
      )
    })}
  </ul>
</div>