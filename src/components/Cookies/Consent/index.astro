---
import { Image } from 'astro:assets'
import Sprite from '@components/Sprite/index.astro'
import Button from '@components/Button/index.astro'
import CookieSvg from '@assets/images/site/cookie.svg'
---

<div
  id="cookie-modal-id"
  class="bg-[var(--color-bg-offset)] bottom-0 left-0 fixed right-0 w-full"
  style="display:none;"
  role="dialog"
  aria-label="cookie consent dialog"
  aria-describedby="cookie-modal__content"
>
  <!-- Close button positioned at far right of viewport -->
  <button
    type="button"
    aria-label="close cookie consent dialog"
    class="cookie-modal__close-btn bg-[var(--color-secondary)] border-none text-[var(--color-text)] flex p-1.5 absolute top-0 right-0 transition-all duration-150 ease-in-out hover:bg-[var(--color-secondary-offset)] hover:text-[var(--color-text)] focus:bg-[var(--color-secondary-offset)] focus:text-[var(--color-text)] focus:outline-none z-10"
  >
    <Sprite name="close" class="h-8 w-8" />
  </button>

  <!-- Modal content container with page column constraints -->
  <div class="rounded-lg mx-auto max-w-[75rem] w-[90%] px-4 sm:px-6 lg:px-8 mb-4 flex flex-row md:flex-col flex-nowrap md:flex-wrap relative">
    {
      /* Desktop: 48px + (12px * 2) = 72px container, half = 36px. Mobile: 3.6em + (0.6em * 2) = 4.8em container, half = 2.4em */
    }
    <div
      class="h-[72px] w-[72px] -top-[36px] md:h-[4.8em] md:w-[4.8em] md:-top-[2.4em] bg-[var(--color-bg-offset)] rounded-full absolute left-0 right-0 mx-auto flex items-center justify-center p-3 md:p-[0.6em]"
    >
      <Image src={CookieSvg} alt="Cookie icon." class="h-12 w-12 md:h-[3.6em] md:w-[3.6em]" />
    </div>
    <div class="pt-9 pb-4 pl-8 pr-8 md:pt-[2.4em] md:pb-4 md:pl-8 md:pr-8 flex flex-wrap items-center gap-4">
      <!-- Buttons first (before text) -->
      <menu class="flex items-center gap-6 order-1">
        <li class="list-none">
          <Button
            text="Allow All"
            variant="success"
            type="button"
            class="cookie-modal__btn-allow !border-0 !border-transparent !shadow-none !text-shadow-none hover:!shadow-none focus:!shadow-none active:!shadow-none !transform-none hover:!transform-none focus:!transform-none active:!transform-none hover:!bg-[var(--color-success-offset)] focus:!bg-[var(--color-success-offset)]"
          />
        </li>
        <li class="list-none">
          <a href="/cookies">
            <Button text="Customize" variant="warning" class="cookie-modal__btn-customize !shadow-none !text-shadow-none hover:!shadow-none focus:!shadow-none active:!shadow-none !transform-none hover:!transform-none focus:!transform-none active:!transform-none !text-white hover:!text-white focus:!text-white" />
          </a>
        </li>
      </menu>

      <!-- Text content second (after buttons) -->
      <p id="cookie-modal__content" class="order-2 flex-1 min-w-0">
        This site uses cookies. Learn more in our <a href="/cookies">Cookie Policy</a> and <a
          href="/privacy">Privacy Policy</a
        >. <span class="md:hidden"
          >Our site needs a single cookie to remember your theme preferences, and you can <a
            class="cookie-modal__link-customize"
            href="/cookies">customize</a
          > the other cookies we use to help provide you a great experience here. Or let us know you're okay
          with our cookie use by clicking <button
            type="button"
            class="cookie-modal__link-allow bg-transparent border-0 text-[var(--color-primary)] underline cursor-pointer hover:text-[var(--color-primary-offset)] focus:text-[var(--color-primary-offset)] p-0"
            >Allow All</button
          >.</span
        >
      </p>
    </div>
  </div>
</div>

<script>
  import { registerScript } from '@components/Scripts/loader'
  import { CookieConsent } from './client'
  registerScript(CookieConsent)
</script>
