---
import { Image } from 'astro:assets'
import Sprite from '@components/Sprite/index.astro'
import logoSvg from '@assets/images/site/logo.svg'
---

<div
  id="cookie-customize-modal-id"
  class="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"
  style="display:none;"
  role="dialog"
  aria-label="customize cookies dialog"
  aria-describedby="cookie-modal__settings-desc"
>
  <div
    class="bg-[var(--color-bg)] rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto"
  >
    {/* Header */}
    <div
      class="sticky top-0 bg-[var(--color-bg)] border-b border-[var(--color-bg-offset)] px-6 py-4 flex items-center justify-between z-10"
    >
      <div class="flex items-center gap-4">
        <Image src={logoSvg} alt="Webstack Builders corporate logo." class="h-8 w-auto" />
        <h2 class="text-2xl font-bold text-[var(--color-text)]">Cookie Preference Center</h2>
      </div>
      <button
        type="button"
        class="cookie-modal__close-btn bg-transparent border-0 text-[var(--color-primary)] outline-none hover:text-[var(--color-success-offset)] focus:text-[var(--color-success-offset)] transition-colors"
        aria-label="Close cookie consent box"
      >
        <Sprite name="close" />
      </button>
    </div>

    {/* Content */}
    <div class="px-6 py-8">
      {/* Introduction */}
      <div class="mb-8">
        <p id="cookie-modal__settings-desc" class="text-[var(--color-text-muted)] leading-relaxed">
          When you visit our website, we store cookies on your browser to collect information. The
          information collected might relate to you, your preferences, or your device, and is mostly
          used to make the site work as you expect it to and to provide a more personalized web
          experience. However, you can choose not to allow certain types of cookies, which may
          impact your experience of the site and the services we are able to offer. Click on the
          different category headings below to find out more and change our default settings
          according to your preference.
        </p>
      </div>

      {/* Cookie Categories */}
      <div class="space-y-6">
        {/* Strictly Necessary Cookies */}
        <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                Strictly Necessary Cookies
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Always Active - Required for basic website functionality
              </p>
            </div>
            <div class="flex items-center">
              <span
                class="text-sm text-green-600 dark:text-green-400 font-medium bg-green-100 dark:bg-green-900/30 px-3 py-1 rounded-full"
              >
                Always Active
              </span>
            </div>
          </div>
          <p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
            These cookies are necessary for our website to function and cannot be switched off in
            our systems. They are usually only set in response to actions made by you which amount
            to a request for services, such as setting your privacy preferences, logging in, or
            filling in forms. Some may be set by us or by third-party providers whose services we
            have added to our pages. You can set your browser to block or alert you about these
            cookies, but some parts of our site will not then work. These cookies do not store any
            personally identifiable information.
          </p>
        </div>

        {/* Performance and Analytics Cookies */}
        <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                Performance and Analytics Cookies
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Help us understand how visitors use our website
              </p>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <span class="sr-only">Toggle Performance and Analytics Cookies</span>
              <input type="checkbox" id="analytics-cookies" class="sr-only peer" checked />
              <div
                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
              >
              </div>
            </label>
          </div>
          <p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
            These cookies, which include Google Analytics, allow us to count visits and traffic
            sources so we can measure and improve the performance of our site. They help us know
            which pages are most and least popular and see how users interact with our site. All
            information these cookies collect is aggregated and therefore anonymous. If you do not
            allow these cookies, we will not know when you have visited our site, and will not be
            able to monitor its performance.
          </p>
        </div>

        {/* Functional Cookies */}
        <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                Functional Cookies
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Enable enhanced functionality and personalization
              </p>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <span class="sr-only">Toggle Functional Cookies</span>
              <input type="checkbox" id="functional-cookies" class="sr-only peer" checked />
              <div
                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
              >
              </div>
            </label>
          </div>
          <p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed mb-3">
            These cookies enable our website to provide enhanced functionality and personalization.
            They may be set by us or by third-party providers whose services we have added to our
            pages. If you do not allow these cookies, then some or all of these services may not
            function properly.
          </p>
          <div class="bg-amber-50 dark:bg-amber-900/20 border border-amber-200 dark:border-amber-800 rounded-lg p-4">
            <p class="text-sm text-amber-800 dark:text-amber-200 leading-relaxed">
              <strong>Note:</strong> Functional storage is used for strictly necessary features like remembering your theme preference, caching social media embeds to reduce API calls, and error logging (no personal data). While we classify this as legitimate interest under GDPR Article 6(1)(f), we respect your choice to opt out. Disabling this will prevent the site from remembering your preferences across visits.
            </p>
          </div>
        </div>

        {/* Advertising Cookies */}
        <div class="border border-gray-200 dark:border-gray-700 rounded-xl p-6">
          <div class="flex items-center justify-between mb-4">
            <div>
              <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                Advertising Cookies
              </h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">
                Used to deliver relevant advertisements
              </p>
            </div>
            <label class="relative inline-flex items-center cursor-pointer">
              <span class="sr-only">Toggle Advertising Cookies</span>
              <input type="checkbox" id="advertising-cookies" class="sr-only peer" />
              <div
                class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"
              >
              </div>
            </label>
          </div>
          <p class="text-gray-600 dark:text-gray-300 text-sm leading-relaxed">
            For websites that display advertising, cookies identify the beginning of a unique user
            session in order to display generic ads during the session. We do not capture
            information about a user session in order to display targeted ads. However, advertising
            cookies may also be set through our site by advertising entities. They may be used by
            those companies to build a profile of your interests and show you relevant adverts on
            other sites. Advertising cookies do not store directly personal information, but are
            based on uniquely identifying your browser and internet device. If you do not allow
            these cookies, you may experience less targeted advertising.
          </p>
        </div>
      </div>
    </div>

    {/* Footer Actions */}
    <div
      class="sticky bottom-0 bg-[var(--color-bg)] border-t border-[var(--color-bg-offset)] px-6 py-4 flex gap-3 justify-end"
    >
      <button
        id="cookie-save-preferences"
        class="px-6 py-2 bg-[var(--color-text-muted)] text-white rounded-lg hover:bg-[var(--color-text)] transition-colors duration-200 font-medium"
      >
        Confirm My Choices
      </button>
      <button
        id="cookie-allow-all"
        class="px-6 py-2 bg-[var(--color-primary)] text-white rounded-lg hover:bg-[var(--color-primary-hover)] transition-colors duration-200 font-medium"
      >
        Allow All
      </button>
    </div>
  </div>
</div>

<!-- Cookie Management Script -->
<script>
  import { registerScript } from '@components/scripts/loader'
  import { CookieCustomize } from '@components/Cookies/Customize/client'

  // Register the script with the loader
  registerScript(CookieCustomize)
</script>
