---
// DownloadForm.astro - Gated form for download resources
import Confetti from '@components/Animations/Confetti/index.astro'

export interface Props {
  title: string
  fileName: string
  fileType?: string
  className?: string
}

const { title, fileName, fileType = 'resource', className = '' } = Astro.props

// Construct the download landing page URL
const downloadUrl = `/downloads/${fileName}`
---

<download-form class={`download-form-wrapper mx-auto max-w-2xl ${className}`.trim()}>
  <div class="bg-bg p-6 md:p-8 rounded-2xl shadow-lg border border-border">
    <div class="mb-6">
      <h3 class="text-xl md:text-2xl font-semibold text-text mb-2">
        Download {title}
      </h3>
      <p class="text-offset">
        Fill out the form below to receive your {fileType.toLowerCase()} instantly.
      </p>
    </div>

    <form class="space-y-4" id="downloadForm" method="post" data-download-url={downloadUrl}>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- First Name -->
        <div class="space-y-2">
          <label for="firstName" class="block text-sm font-medium text-text-offset">
            First Name <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="firstName"
            name="firstName"
            autocomplete="given-name"
            class="w-full px-4 py-3 border-2 border-border rounded-xl bg-bg text-text focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200"
            required
            placeholder="John"
            minlength="2"
            maxlength="50"
          />
        </div>

        <!-- Last Name -->
        <div class="space-y-2">
          <label for="lastName" class="block text-sm font-medium text-text-offset">
            Last Name <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="lastName"
            name="lastName"
            autocomplete="family-name"
            class="w-full px-4 py-3 border-2 border-border rounded-xl bg-bg text-text focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200"
            required
            placeholder="Doe"
            minlength="2"
            maxlength="50"
          />
        </div>
      </div>

      <!-- Work Email -->
      <div class="space-y-2">
        <label for="workEmail" class="block text-sm font-medium text-text-offset">
          Work Email <span class="text-red-500">*</span>
        </label>
        <input
          type="email"
          id="workEmail"
          name="workEmail"
          autocomplete="email"
          class="w-full px-4 py-3 border-2 border-border rounded-xl bg-bg text-text focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200"
          required
          placeholder="john.doe@company.com"
        />
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Job Title -->
        <div class="space-y-2">
          <label for="jobTitle" class="block text-sm font-medium text-text-offset">
            Job Title <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="jobTitle"
            name="jobTitle"
            autocomplete="organization-title"
            class="w-full px-4 py-3 border-2 border-border rounded-xl bg-bg text-text focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200"
            required
            placeholder="Software Engineer"
            maxlength="100"
          />
        </div>

        <!-- Company Name -->
        <div class="space-y-2">
          <label for="companyName" class="block text-sm font-medium text-text-offset">
            Company Name <span class="text-red-500">*</span>
          </label>
          <input
            type="text"
            id="companyName"
            name="companyName"
            autocomplete="organization"
            class="w-full px-4 py-3 border-2 border-border rounded-xl bg-bg text-text focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200"
            required
            placeholder="Acme Corporation"
            maxlength="100"
          />
        </div>
      </div>

      <!-- Privacy Notice -->
      <div class="pt-4 border-t border-border">
        <p class="text-xs text-text-offset leading-relaxed">
          By submitting this form, you agree to receive marketing communications from Webstack
          Builders. You can unsubscribe at any time. View our
          <a
            href="/privacy"
            class="text-primary hover:underline focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded"
          >
            Privacy Policy
          </a>.
        </p>
      </div>

      <!-- Submit Button -->
      <Confetti>
        <div class="pt-2">
          <button
            type="submit"
            class="w-full bg-primary text-white font-semibold py-3 px-6 rounded-xl hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
            id="downloadSubmitBtn"
          >
            Download Now
          </button>
        </div>
      </Confetti>

      <!-- Download Button (hidden until form is successfully submitted) -->
      <div class="pt-2 hidden" id="downloadButtonWrapper">
        <a
          href={downloadUrl}
          target="_blank"
          rel="noopener noreferrer"
          class="block w-full bg-green-600 text-white font-semibold py-3 px-6 rounded-xl hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-600 focus:ring-offset-2 transition-all duration-200 text-center"
          id="downloadBtn"
        >
          <svg
            class="inline-block w-5 h-5 mr-2 -mt-1"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
            ></path>
          </svg>
          Download {fileType}
        </a>
      </div>

      <!-- Status Messages -->
      <div
        id="downloadFormStatus"
        class="hidden p-4 rounded-xl text-sm"
        role="alert"
        aria-live="polite"
      >
      </div>
    </form>
  </div>
</download-form>

<style>
  #downloadFormStatus.success {
    background-color: var(--color-success-bg);
    border: 1px solid var(--color-success-border);
    color: var(--color-success-text);
    display: block;
  }

  #downloadFormStatus.error {
    background-color: var(--color-error-bg);
    border: 1px solid var(--color-error-border);
    color: var(--color-error-text);
    display: block;
  }
</style>

<script>
  import { registerDownloadFormWebComponent } from '@components/Forms/Download/client'
  registerDownloadFormWebComponent()
</script>
