---
import GDPRConsent from '@components/Consent/Checkbox/index.astro'
import Confetti from '@components/Animations/Confetti/index.astro'
import './uppy-audio.css'
import './uppy-core.css'
import './uppy-dashboard.css'
import './uppy-webcam.css'
import './validation.css'

export type Props = {
  content: {
    header: {
      title: string
      description: string
    }
  }
}

const { content } = Astro.props
---

<contact-form>
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 lg:gap-12 items-start">
    <!-- Contact Form -->
    <div class="lg:col-span-2 bg-content-inverse p-6 md:p-8 rounded-2xl shadow-lg">
      <slot name="contact-form-header" />

      <form
      class="space-y-8"
        id="contactForm"
        method="post"
        enctype="multipart/form-data"
        novalidate
      >
        <div
          id="formErrorBanner"
          class="hidden rounded-xl border border-danger bg-danger/10 text-danger px-4 py-3"
          role="alert"
          aria-live="assertive"
        >
          Please fix the errors in your message and hit the submit button again.
        </div>

        <!-- Personal Information -->
        <div class="pb-6 border-b border-trim">
          <h3 class="flex items-center text-xl font-semibold mb-6">
            <div class="w-1 h-5 bg-spotlight rounded-full mr-3"></div>
            Contact Information
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label for="name" class="block text-content-active text-sm font-medium"
                >Full Name *</label
              >
              <input
                type="text"
                id="name"
                name="name"
                class="w-full px-4 py-3 border-2 border-trim rounded-xl bg-content-inverse focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200"
                required
                placeholder="Your full name"
                minlength="2"
                maxlength="100"
                aria-invalid="false"
                aria-errormessage="name-error"
              />
              <p
                class="hidden text-sm text-danger"
                data-field-error="name"
                aria-live="polite"
                id="name-error"
              >
              </p>
            </div>

            <div class="space-y-2">
              <label for="email" class="block text-content-active text-sm font-medium"
                >Email Address *</label
              >
              <input
                type="email"
                id="email"
                name="email"
                class="w-full px-4 py-3 border-2 border-trim rounded-xl bg-content-inverse focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200"
                required
                placeholder="your.email@example.com"
                aria-invalid="false"
                aria-errormessage="email-error"
              />
              <p
                class="hidden text-sm text-danger"
                data-field-error="email"
                aria-live="polite"
                id="email-error"
              >
              </p>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label for="company" class="block text-content-active text-sm font-medium"
                >Company Name</label
              >
              <input
                type="text"
                id="company"
                name="company"
                class="w-full px-4 py-3 border-2 border-trim rounded-xl bg-content-inverse focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200"
                placeholder="Your company name"
                maxlength="100"
              />
            </div>

            <div class="space-y-2">
              <label for="phone" class="block text-content-active text-sm font-medium"
                >Phone Number</label
              >
              <input
                type="tel"
                id="phone"
                name="phone"
                class="w-full px-4 py-3 border-2 border-trim rounded-xl bg-content-inverse focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200"
                placeholder="+1 (555) 123-4567"
              />
            </div>
          </div>
        </div>

        <!-- Project Information -->
        <div class="pb-6 border-b border-trim">
          <h3 class="flex items-center text-xl font-semibold mb-6">
            <div class="w-1 h-5 bg-spotlight rounded-full mr-3"></div>
            Project Details
          </h3>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-2">
              <label for="project_type" class="block text-content-active text-sm font-medium"
                >Project Type</label
              >
              <select
                id="project_type"
                name="project_type"
                class="w-full px-4 py-3 border-2 border-trim rounded-xl bg-content-inverse focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200 cursor-pointer"
              >
                <option value="">Select project type</option>
                <option value="website">New Website</option>
                <option value="redesign">Website Redesign</option>
                <option value="ecommerce">E-commerce Store</option>
                <option value="webapp">Web Application</option>
                <option value="mobile">Mobile App</option>
                <option value="api">API Development</option>
                <option value="consulting">Consulting</option>
                <option value="maintenance">Maintenance & Support</option>
                <option value="other">Other</option>
              </select>
            </div>

            <div class="space-y-2">
              <label for="budget" class="block text-content-active text-sm font-medium"
                >Budget Range *</label
              >
              <select
                id="budget"
                name="budget"
                required
                class="w-full px-4 py-3 border-2 border-trim rounded-xl bg-content-inverse focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200 cursor-pointer"
              >
                <option value="">Select budget range</option>
                <option value="5k-10k">$5,000 - $10,000</option>
                <option value="10k-25k">$10,000 - $25,000</option>
                <option value="25k-50k">$25,000 - $50,000</option>
                <option value="50k+">$50,000+</option>
              </select>
            </div>
          </div>

          <div class="space-y-2">
            <label for="timeline" class="block text-content-active text-sm font-medium"
              >Project Timeline *</label
            >
            <select
              id="timeline"
              name="timeline"
              class="w-full px-4 py-3 border-2 border-trim rounded-xl bg-content-inverse focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200 cursor-pointer"
            >
              <option value="">Select timeline</option>
              <option value="asap">ASAP</option>
              <option value="1-month">Within 1 month</option>
              <option value="2-3-months">2-3 months</option>
              <option value="3-6-months">3-6 months</option>
              <option value="6-months-plus">6+ months</option>
              <option value="flexible">Flexible</option>
            </select>
          </div>

          <div class="space-y-2">
            <label for="message" class="block text-content-active text-sm font-medium"
              >Project Description *</label
            >
            <textarea
              id="message"
              name="message"
              class="w-full px-4 py-3 border-2 border-trim rounded-xl bg-content-inverse focus:border-primary focus:ring-0 focus:outline-none transition-colors duration-200 resize-vertical min-h-30"
              rows="6"
              required
              placeholder="Describe your project, goals, target audience, and any specific requirements..."
              minlength="10"
              maxlength="2000"
              aria-invalid="false"
              aria-errormessage="message-error"></textarea>
            <p
              class="hidden text-sm text-danger"
              data-field-error="message"
              aria-live="polite"
              id="message-error"
            >
            </p>
            <div class="text-right text-sm text-content-active">
              <span id="charCount">0</span>/2000 characters
            </div>
          </div>
        </div>

        <!-- File Upload Section -->
        <div class="pb-6">
          <h3 class="flex items-center text-xl font-semibold mb-4">
            <div class="w-1 h-5 bg-spotlight rounded-full mr-3"></div>
            Project Files (Optional)
          </h3>
          <p class="text-content-active text-sm mb-6">
            Upload any relevant files like mockups, specifications, existing designs, or reference
            materials.
          </p>

          <div
            class="border-2 border-dashed border-trim rounded-xl p-8 text-center bg-page-offset hover:border-primary-hover transition-colors duration-200"
          >
            <div id="uppyContainer" hidden>
              <div id="uppyDashboard"></div>
            </div>
            <div class="mt-4 space-y-2">
              <p class="text-sm text-content-active">
                <strong>Supported formats:</strong> PDF, DOC, DOCX, JPG, PNG, GIF, WebP, MP3, WAV, MP4,
                MOV, ZIP, TXT
              </p>
              <p class="text-sm text-content-active">
                <strong>Max file size:</strong> 10MB per file • <strong>Max files:</strong> 5
              </p>
            </div>
          </div>
        </div>

        <!-- GDPR Consent -->
        <GDPRConsent
          purpose="responding to your inquiry"
          formId="contact-form"
          id="contact-gdpr-consent"
          variant="default"
        />

        <!-- Data Retention Notice -->
        <div
          class="text-sm text-content-active space-y-2 bg-page-offset p-4 rounded-lg border border-trim"
        >
          <p>
            <strong>Data Retention:</strong> Your contact information will be stored for 90 days to respond
            to your inquiry.
          </p>
          <p>
            <strong>Your Rights:</strong> You can request access, correction, or deletion of your data
            at any time by contacting <a
              href="mailto:gdpr@webstackbuilders.com"
              class="text-primary hover:underline">gdpr@webstackbuilders.com</a
            >.
          </p>
        </div>

        <Confetti>
          <div class="flex justify-end">
            <button
              type="submit"
              class="inline-flex items-center justify-center px-8 py-4 bg-spotlight hover:bg-spotlight-offset text-white font-semibold rounded-xl transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5 disabled:opacity-60 disabled:cursor-not-allowed disabled:transform-none min-w-50"
              id="submitBtn"
            >
              <span class="btn-text">Send Project Details</span>
              <span class="btn-loading hidden">
                <svg
                  class="animate-spin w-5 h-5 mr-2"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  focusable="false"
                >
                  <circle
                    cx="12"
                    cy="12"
                    r="10"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    opacity="0.3"></circle>
                  <path d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z" fill="currentColor"></path>
                </svg>
                Sending...
              </span>
            </button>
          </div>
        </Confetti>
      </form>

      <!-- Form Messages -->
      <div id="formMessages" class="mt-8 rounded-xl overflow-hidden" style="display: none;">
        <div class="message-success hidden" role="status" aria-live="polite" aria-atomic="true">
          <div class="flex items-start p-6 bg-success-inverse  border border-success gap-4">
            <div
              class="shrink-0 w-6 h-6 bg-success text-white rounded-full flex items-center justify-center text-sm font-bold"
            >
              ✓
            </div>
            <div>
              <h3 class="text-lg font-semibold text-success mb-2">Thank you!</h3>
              <p>
                Your project details have been sent successfully. We'll review everything and get
                back to you within 24 hours with a detailed proposal.
              </p>
            </div>
          </div>
        </div>
        <div class="message-error hidden" role="alert" aria-live="assertive" aria-atomic="true">
          <div class="flex items-start p-6 bg-danger-offset border border-danger gap-4">
            <div
              class="shrink-0 w-6 h-6 bg-danger text-white rounded-full flex items-center justify-center text-sm font-bold"
            >
              ⚠
            </div>
            <div>
              <h3 class="text-lg font-semibold text-danger mb-2">Oops!</h3>
              <p id="errorMessage">
                Something went wrong. Please try again later.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <slot name="contact-information" />
  </div>
</contact-form>

<script>
  import { registerContactFormWebComponent } from '@components/Forms/Contact/client'
  registerContactFormWebComponent()
</script>
