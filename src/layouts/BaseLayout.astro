---
import Breadcrumbs from '@components/Breadcrumbs/index.astro'
import Container from '@components/Layout/Container/index.astro'
import CookieConsent from '@components/Consent/Banner/index.astro'
import FooterPreact from '@components/Footer/FooterPreact'
import HeadContent from '@components/Head/index.astro'
import Header from '@components/Header/index.astro'
import Content from '@components/Layout/Content/index.astro'
import PwaTitleBar from '@components/PwaTitleBar/index.astro'
import Skip from '@components/Layout/Skip/index.astro'
import ThemePicker from '@components/ThemePicker/index.astro'
import { ClientRouter } from 'astro:transitions'
import VtBotDebug from 'astro-vtbot/components/VtBotDebug.astro'
import Linter from 'astro-vtbot/components/Linter.astro'
import AuthorAvatar from '@assets/images/avatars/kevin-brown.webp'

import '@styles/index.css'
import '@styles/sprites.css'
import '@components/Footer/footer.css'

export interface Props {
  pageTitle: string
  /** The URL path component e.g. 'articles/my-article' */
  path: string
  /** Enforce that child is passed to slot */
  children?: unknown
  /** Optional metadata for articles */
  contentType?: 'article' | 'website'
  publishDate?: Date
  modifiedDate?: Date
  author?: string
  section?: string
  tags?: string[]
  description?: string
  image?: string
  noindex?: boolean
}

const {
  pageTitle,
  path,
  contentType,
  publishDate,
  modifiedDate,
  author,
  section,
  tags,
  description,
  image,
  noindex,
} = Astro.props

const year = new Date().getFullYear()
const siteUrl = Astro.site?.toString() || 'https://webstackbuilders.com'
// Get the image src path for Preact
const avatarSrc = AuthorAvatar.src
---

<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <HeadContent
      pageTitle={pageTitle}
      path={path}
      {...description && { description }}
      {...image && { image }}
      {...noindex && { noindex }}
      {...contentType && { contentType }}
      {...publishDate && { publishDate }}
      {...modifiedDate && { modifiedDate }}
      {...author && { author }}
      {...section && { section }}
      {...tags && { tags }}
    />
    {/* Client-side router for Astro pages (enables partial page reloads) */}
    {/* Must be placed at the end of the <head> to avoid blocking page rendering */}
    <VtBotDebug />
    <ClientRouter />
    <Linter expanded />
  </head>
  <body>
    {/* Cookie Consent Overlay */}
    <CookieConsent />
    {/* Skip to main content link for accessibility */}
    <Skip />
    {/* Sets Window Controls Overlay API for PWA title bar */}
    <PwaTitleBar />
    {/* Site header and main content */}
    <Container id="main-content">
      <ThemePicker client:load />
      <Header path={path} />
      <Breadcrumbs path={path} pageTitle={pageTitle} />
      {/* Main page content */}
      <Content>
        <slot />
      </Content>
      {/* Site footer - Preact component */}
      <FooterPreact year={year} siteUrl={siteUrl} authorAvatar={avatarSrc} client:load transition:name="footer-island" transition:persist />
    </Container>
  </body>
</html>
