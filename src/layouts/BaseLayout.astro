---
import Breadcrumbs from '@components/Breadcrumbs/index.astro'
import Container from '@components/Layout/Container/index.astro'
import CookieConsent from '@components/Cookies/Consent/index.astro'
import Footer from '@components/Footer/index.astro'
import HeadContent from '@components/Head/index.astro'
import Header from '@components/Header/index.astro'
import Content from '@components/Layout/Content/index.astro'
import PwaTitleBar from '@components/PwaTitleBar/index.astro'
import Skip from '@components/Layout/Skip/index.astro'
import ViewTransitionTest from '@components/Test/ViewTransitionTest.astro'
import ThemePicker from '@components/ThemePicker/index.astro'
import { ClientRouter } from 'astro:transitions'

import '@styles/index.css'
import '@styles/sprites.css'

export interface Props {
  pageTitle: string
  /** The URL path component e.g. 'articles/my-article' */
  path: string
  /** Enforce that child is passed to slot */
  children?: unknown
  /** Optional metadata for articles */
  contentType?: 'article' | 'website'
  publishDate?: Date
  modifiedDate?: Date
  author?: string
  section?: string
  tags?: string[]
  description?: string
  image?: string
  noindex?: boolean
}

const {
  pageTitle,
  path,
  contentType,
  publishDate,
  modifiedDate,
  author,
  section,
  tags,
  description,
  image,
  noindex,
} = Astro.props
---

<!DOCTYPE html>
<html lang="en" data-theme="light">
  <head>
    <HeadContent
      pageTitle={pageTitle}
      path={path}
      {...description && { description }}
      {...image && { image }}
      {...noindex && { noindex }}
      {...contentType && { contentType }}
      {...publishDate && { publishDate }}
      {...modifiedDate && { modifiedDate }}
      {...author && { author }}
      {...section && { section }}
      {...tags && { tags }}
    />
    {/* Client-side router for Astro pages (enables partial page reloads) */}
    {/* Must be placed at the end of the <head> to avoid blocking page rendering */}
    <ClientRouter />
  </head>
  <body>
    {/* Cookie Consent Overlay - Only persist in production mode */}
    {import.meta.env.PROD ? (
      <CookieConsent transition:persist />
    ) : (
      <CookieConsent />
    )}
    {/* Skip to main content link for accessibility */}
    <Skip />
    {/* Sets Window Controls Overlay API for PWA title bar */}
    <PwaTitleBar />
    {/* Site header and main content */}
    <Container id="main-content">
      {/* Theme Picker Modal - uses transition:persist in production for View Transitions API */}
      {import.meta.env.PROD ? (
        <ThemePicker transition:persist />
      ) : (
        <ThemePicker />
      )}
      <Header path={path} />
      <Breadcrumbs path={path} pageTitle={pageTitle} />
      {/* Main page content */}
      <Content>
        <slot />
      </Content>
      {/* Site footer */}
      <Footer />
    </Container>
    {/* View Transition Test Element for E2E Regression Tests */}
    <ViewTransitionTest />
  </body>
</html>
